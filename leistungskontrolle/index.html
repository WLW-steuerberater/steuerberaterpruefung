<!doctype html>
<html lang="de">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steuerrecht Lernkontrolle</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #1d1d1f;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            font-size: 1.1rem;
            color: #6e6e73;
            margin: 0;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e5e7;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #30d158, #32d74b);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #6e6e73;
            text-align: center;
        }

        .task-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .task-card.active {
            display: block;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .task-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .task-type {
            color: #6e6e73;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .task-question {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            font-size: 1rem;
            background: #f5f5f7;
            transition: all 0.2s ease;
            margin-bottom: 15px;
        }

        .input-field:focus {
            outline: none;
            border-color: #007aff;
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        .gap-text {
            display: inline-block;
            min-width: 120px;
            padding: 8px 12px;
            border: 2px dashed #007aff;
            border-radius: 8px;
            background: rgba(0, 122, 255, 0.05);
            margin: 0 4px;
            text-align: center;
            font-weight: 500;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .option-button {
            padding: 16px 20px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            background: #f5f5f7;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            text-align: center;
            font-weight: 500;
        }

        .option-button:hover {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.05);
        }

        .option-button.selected {
            border-color: #007aff;
            background: #007aff;
            color: white;
        }

        .sortable-container {
            background: linear-gradient(135deg, #f8f9fa, #f0f2f5);
            border: 3px dashed #d1d5db;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 25px;
            min-height: 280px;
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .sortable-container.drag-over {
            border-color: #007aff;
            border-style: solid;
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(0, 122, 255, 0.04));
            transform: scale(1.01);
            box-shadow: inset 0 2px 8px rgba(0, 122, 255, 0.1), 0 8px 25px rgba(0, 122, 255, 0.15);
            animation: containerPulse 2s ease-in-out infinite alternate;
        }

        @keyframes containerPulse {
            0% { 
                box-shadow: inset 0 2px 8px rgba(0, 122, 255, 0.1), 0 8px 25px rgba(0, 122, 255, 0.15);
            }
            100% { 
                box-shadow: inset 0 2px 8px rgba(0, 122, 255, 0.15), 0 12px 35px rgba(0, 122, 255, 0.25);
            }
        }

        .sortable-item {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            padding: 18px 24px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04);
            user-select: none;
            position: relative;
            transform: translateZ(0);
            will-change: transform, box-shadow, opacity;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border-left: 4px solid transparent;
        }

        .sortable-item:last-child {
            margin-bottom: 0;
        }

        .sortable-item:hover {
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-6px) scale(1.02);
            border-color: rgba(0, 122, 255, 0.3);
            border-left-color: #007aff;
            background: linear-gradient(135deg, #ffffff, #f0f8ff);
        }

        .sortable-item:active {
            cursor: grabbing;
            transform: translateY(-2px) scale(1.01);
        }

        .sortable-item.dragging {
            opacity: 0.9;
            transform: scale(1.08) translateZ(0);
            z-index: 1000;
            box-shadow: 0 20px 50px rgba(0, 122, 255, 0.3), 0 8px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-color: #007aff;
            border-left-color: #007aff;
            background: linear-gradient(135deg, #ffffff, #e6f3ff);
            animation: dragPulse 1.5s ease-in-out infinite alternate;
        }

        .sortable-item.drag-preview {
            animation: dragFloat 0.8s ease-in-out infinite alternate;
        }

        .sortable-item.drag-over-top {
            border-top: 4px solid #007aff;
            transform: translateY(-8px) scale(1.02);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.2);
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
        }

        .sortable-item.drag-over-bottom {
            border-bottom: 4px solid #007aff;
            transform: translateY(8px) scale(1.02);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.2);
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
        }

        .sortable-item.inserting {
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .sortable-item.drop-success {
            animation: dropSuccess 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes dragFloat {
            0% { 
                transform: scale(1.08) translateY(0px);
                box-shadow: 0 20px 50px rgba(0, 122, 255, 0.3), 0 8px 20px rgba(0, 0, 0, 0.2);
            }
            100% { 
                transform: scale(1.08) translateY(-8px);
                box-shadow: 0 25px 60px rgba(0, 122, 255, 0.4), 0 12px 25px rgba(0, 0, 0, 0.25);
            }
        }

        @keyframes dragPulse {
            0% { 
                box-shadow: 0 20px 50px rgba(0, 122, 255, 0.3), 0 8px 20px rgba(0, 0, 0, 0.2);
            }
            100% { 
                box-shadow: 0 25px 60px rgba(0, 122, 255, 0.5), 0 12px 30px rgba(0, 0, 0, 0.3);
            }
        }

        @keyframes slideIn {
            0% { 
                opacity: 0.3;
                transform: translateX(-20px) scale(0.9);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }
            50% {
                opacity: 0.8;
                transform: translateX(5px) scale(1.05);
                box-shadow: 0 8px 20px rgba(0, 122, 255, 0.2);
            }
            100% { 
                opacity: 1;
                transform: translateX(0) scale(1);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04);
            }
        }

        @keyframes dropSuccess {
            0% { 
                transform: scale(1);
                background: linear-gradient(135deg, #ffffff, #f8f9fa);
            }
            25% { 
                transform: scale(1.05);
                background: linear-gradient(135deg, #e6ffe6, #f0fff0);
                border-color: #30d158;
                box-shadow: 0 8px 25px rgba(48, 209, 88, 0.3);
            }
            50% { 
                transform: scale(1.02);
                background: linear-gradient(135deg, #e6ffe6, #f0fff0);
            }
            100% { 
                transform: scale(1);
                background: linear-gradient(135deg, #ffffff, #f8f9fa);
                border-color: #e5e5e7;
            }
        }

        /* Neue Zuordnungs-Styles */
        .category-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .drop-zone {
            background: linear-gradient(135deg, #f5f5f7, #e8e8ea);
            border: 3px dashed #c7c7cc;
            border-radius: 16px;
            padding: 20px;
            min-height: 180px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .drop-zone:hover::before {
            opacity: 1;
        }

        .drop-zone.drag-over {
            border-color: #007aff;
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(0, 122, 255, 0.05));
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.2);
        }

        .drop-zone h4 {
            margin: 0 0 10px 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: #1d1d1f;
        }

        .category-description {
            font-size: 0.9rem;
            color: #6e6e73;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .dropped-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 60px;
        }

        .terms-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .terms-container h4 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1d1d1f;
            text-align: center;
        }

        .draggable-terms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .draggable-term {
            background: white;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            padding: 15px;
            cursor: grab;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            transform: translateZ(0);
            user-select: none;
        }

        .draggable-term:hover {
            border-color: #007aff;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.15);
        }

        .draggable-term:active {
            cursor: grabbing;
        }

        .draggable-term.dragging {
            opacity: 0.7;
            transform: rotate(3deg) scale(1.05);
            z-index: 1000;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .draggable-term.dropped {
            background: rgba(48, 209, 88, 0.1);
            border-color: #30d158;
            cursor: default;
            animation: dropSuccess 0.6s ease-out;
        }



        .term-icon {
            font-size: 1.2rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        @keyframes dropSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Responsive Anpassungen für Zuordnung */
        @media (max-width: 768px) {
            .category-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .draggable-terms {
                grid-template-columns: 1fr;
            }
            
            .drop-zone {
                min-height: 120px;
                padding: 15px;
            }
        }

        /* Verbindungsaufgabe Styles */
        .connection-container {
            display: grid;
            grid-template-columns: 1fr 120px 1fr;
            gap: 0;
            margin: 30px 0;
            position: relative;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            padding: 25px;
            min-height: 300px;
        }

        .connection-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .connection-column h4 {
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1d1d1f;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e5e7;
        }

        .connection-item {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            user-select: none;
        }

        .connection-item:hover {
            border-color: #007aff;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.15);
        }

        .connection-item.selected {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.1);
            transform: scale(1.02);
        }

        .connection-item.connected {
            border-color: #30d158;
            background: rgba(48, 209, 88, 0.1);
        }

        .left-column .connection-item {
            justify-content: flex-start;
        }

        .right-column .connection-item {
            justify-content: flex-end;
        }

        .connection-text {
            font-weight: 500;
            font-size: 1rem;
        }

        .connection-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e5e5e7;
            border: 3px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
            flex-shrink: 0;
        }

        .connection-dot[data-side="right"] {
            margin-left: 15px;
            margin-right: 0;
        }

        .connection-dot[data-side="left"] {
            margin-left: 0;
            margin-right: 15px;
        }

        .connection-dot:hover {
            background: #007aff;
            transform: scale(1.3);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.2);
        }

        .connection-dot.active {
            background: #007aff;
            transform: scale(1.2);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.3);
            animation: pulse 1.5s infinite;
        }

        .connection-dot.connected {
            background: #30d158;
            transform: scale(1.1);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.3); }
            50% { box-shadow: 0 0 0 8px rgba(0, 122, 255, 0.1); }
            100% { box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.3); }
        }

        .connection-lines {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .connection-lines svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: visible;
        }

        .connection-container {
            position: relative;
        }

        .connection-container svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: visible;
        }

        .connection-line {
            stroke: #007aff;
            stroke-width: 3;
            fill: none;
            opacity: 0.8;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 122, 255, 0.2));
        }

        .connection-line.correct {
            stroke: #30d158;
            stroke-width: 4;
            opacity: 1;
        }

        .connection-line.incorrect {
            stroke: #ff3b30;
            stroke-width: 3;
            opacity: 0.9;
            stroke-dasharray: 8, 4;
        }

        .connection-instructions {
            background: rgba(0, 122, 255, 0.05);
            border: 1px solid rgba(0, 122, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .connection-instructions p {
            margin: 0;
            color: #1d1d1f;
            font-size: 0.95rem;
        }

        /* Responsive Anpassungen für Verbindungen */
        @media (max-width: 768px) {
            .connection-container {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .connection-lines {
                display: none;
            }
            
            .connection-item {
                justify-content: center !important;
                text-align: center;
            }
            
            .connection-dot {
                margin: 0 10px !important;
            }
            
            .connection-instructions {
                order: -1;
            }
        }



        .slider-container {
            margin: 25px 0;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e5e7;
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 15px;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #007aff;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        .slider-value {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #007aff;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #007aff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056cc;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3);
        }

        .btn-secondary {
            background: #f5f5f7;
            color: #1d1d1f;
            border: 2px solid #e5e5e7;
        }

        .btn-secondary:hover {
            background: #e5e5e7;
        }

        .feedback {
            margin-top: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 500;
            display: none;
        }

        .feedback.correct {
            background: rgba(48, 209, 88, 0.1);
            border: 2px solid #30d158;
            color: #1d4ed8;
        }

        .feedback.incorrect {
            background: rgba(255, 59, 48, 0.1);
            border: 2px solid #ff3b30;
            color: #dc2626;
        }

        .completion-screen {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .completion-screen.active {
            display: block;
        }

        .completion-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .completion-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #30d158;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #007aff;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6e6e73;
            margin-top: 5px;
        }

        /* Speed-Quiz Styles */
        .speed-quiz-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }

        .speed-quiz-start {
            padding: 20px;
        }

        .speed-quiz-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .speed-quiz-start h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 15px 0;
            color: #1d1d1f;
        }

        .speed-quiz-start p {
            font-size: 1.1rem;
            color: #6e6e73;
            margin: 10px 0;
        }

        .speed-quiz-header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .quiz-progress {
            font-size: 1.2rem;
            font-weight: 600;
            color: #007aff;
            text-align: left;
        }

        .quiz-timer {
            display: flex;
            justify-content: center;
        }

        .timer-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(#ff3b30 0deg, #e5e5e7 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: background 0.1s linear;
        }

        .timer-circle::before {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
        }

        #timer-text {
            position: relative;
            z-index: 2;
            font-size: 1.8rem;
            font-weight: 700;
            color: #1d1d1f;
        }

        .quiz-score {
            font-size: 1.2rem;
            font-weight: 600;
            color: #30d158;
            text-align: right;
        }

        .speed-question {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 30px 0;
            padding: 25px;
            background: rgba(0, 122, 255, 0.05);
            border-radius: 16px;
            border: 2px solid rgba(0, 122, 255, 0.2);
            line-height: 1.4;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .speed-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .speed-option {
            padding: 20px;
            border: 3px solid #e5e5e7;
            border-radius: 16px;
            background: white;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .speed-option:hover {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.15);
        }

        .speed-option:active {
            transform: translateY(0);
        }

        .speed-option.correct {
            border-color: #30d158;
            background: rgba(48, 209, 88, 0.1);
            animation: correctPulse 0.6s ease-out;
        }

        .speed-option.incorrect {
            border-color: #ff3b30;
            background: rgba(255, 59, 48, 0.1);
            animation: incorrectShake 0.6s ease-out;
        }

        .speed-option.disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        .speed-feedback {
            margin: 20px 0;
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .speed-feedback.show {
            opacity: 1;
        }

        .speed-feedback.correct {
            background: rgba(48, 209, 88, 0.1);
            border: 2px solid #30d158;
            color: #1d4ed8;
        }

        .speed-feedback.incorrect {
            background: rgba(255, 59, 48, 0.1);
            border: 2px solid #ff3b30;
            color: #dc2626;
        }

        .speed-quiz-results {
            padding: 30px;
        }

        .results-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .results-message {
            font-size: 1.1rem;
            color: #6e6e73;
            margin-top: 20px;
            line-height: 1.5;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Responsive Anpassungen für Speed-Quiz */
        @media (max-width: 768px) {
            .speed-quiz-header {
                grid-template-columns: 1fr;
                gap: 15px;
                text-align: center;
            }
            
            .quiz-progress, .quiz-score {
                text-align: center;
            }
            
            .timer-circle {
                width: 60px;
                height: 60px;
            }
            
            .timer-circle::before {
                width: 45px;
                height: 45px;
            }
            
            #timer-text {
                font-size: 1.4rem;
            }
            
            .speed-options {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .results-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* Steuer-Tetris Styles */
        .tetris-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .tetris-start {
            padding: 20px;
        }

        .tetris-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .tetris-start h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 15px 0;
            color: #1d1d1f;
        }

        .tetris-start p {
            font-size: 1.1rem;
            color: #6e6e73;
            margin: 10px 0;
        }

        .tetris-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .tetris-score, .tetris-progress, .tetris-lives {
            font-size: 1.1rem;
            font-weight: 600;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 2px solid #e5e5e7;
        }

        .tetris-score {
            color: #30d158;
        }

        .tetris-progress {
            color: #007aff;
        }

        .tetris-lives {
            color: #ff3b30;
        }

        .tetris-game-area {
            position: relative;
            height: 400px;
            background: linear-gradient(135deg, #f5f5f7, #e8e8ea);
            border-radius: 16px;
            border: 3px solid #e5e5e7;
            margin: 20px 0;
            overflow: hidden;
        }

        .falling-term {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            transition: none;
            pointer-events: none;
        }

        .term-content {
            background: linear-gradient(135deg, #007aff, #0056cc);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.3);
            min-width: 180px;
            text-align: center;
            animation: termGlow 2s ease-in-out infinite alternate;
        }

        @keyframes termGlow {
            0% { box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3); }
            100% { box-shadow: 0 12px 35px rgba(0, 122, 255, 0.5); }
        }

        .tetris-zones {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 120px;
        }

        .tetris-zone {
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid #e5e5e7;
            border-bottom: none;
            padding: 15px 10px;
            text-align: center;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .tetris-zone:first-child {
            border-left: none;
        }

        .tetris-zone:last-child {
            border-right: none;
        }

        .tetris-zone h4 {
            font-size: 1rem;
            font-weight: 700;
            margin: 0 0 5px 0;
            color: #1d1d1f;
        }

        .tetris-zone p {
            font-size: 0.8rem;
            color: #6e6e73;
            margin: 0;
            line-height: 1.2;
        }

        .tetris-zone.active {
            background: rgba(0, 122, 255, 0.1);
            border-color: #007aff;
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.2);
        }

        .tetris-zone.correct {
            background: rgba(48, 209, 88, 0.1);
            border-color: #30d158;
            animation: correctZone 0.6s ease-out;
        }

        .tetris-zone.incorrect {
            background: rgba(255, 59, 48, 0.1);
            border-color: #ff3b30;
            animation: incorrectZone 0.6s ease-out;
        }

        .zone-indicator {
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            height: 6px;
            background: transparent;
            transition: background 0.3s ease;
        }

        .tetris-zone.active .zone-indicator {
            background: linear-gradient(90deg, #007aff, #0056cc);
            animation: indicatorPulse 1s ease-in-out infinite alternate;
        }

        @keyframes indicatorPulse {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @keyframes correctZone {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.05); }
            100% { transform: translateY(0) scale(1); }
        }

        @keyframes incorrectZone {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .tetris-instructions {
            background: rgba(0, 122, 255, 0.05);
            border: 1px solid rgba(0, 122, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
        }

        .tetris-instructions p {
            margin: 0;
            color: #1d1d1f;
            font-size: 0.95rem;
        }

        .tetris-results {
            padding: 30px;
        }

        .tetris-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .tetris-stat {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .tetris-results-message {
            font-size: 1.1rem;
            color: #6e6e73;
            margin-top: 20px;
            line-height: 1.5;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes feedbackPop {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes swipeIndicatorPop {
            0% { 
                opacity: 0;
                transform: scale(0.5) translateY(-10px);
            }
            50% { 
                opacity: 1;
                transform: scale(1.2) translateY(0);
            }
            100% { 
                opacity: 0;
                transform: scale(1) translateY(5px);
            }
        }

        /* Responsive Anpassungen für Tetris */
        @media (max-width: 768px) {
            .tetris-header {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .tetris-game-area {
                height: 350px;
            }
            
            .tetris-zones {
                height: 100px;
            }
            
            .tetris-zone h4 {
                font-size: 0.9rem;
            }
            
            .tetris-zone p {
                font-size: 0.7rem;
            }
            
            .term-content {
                font-size: 1rem;
                padding: 12px 20px;
                min-width: 150px;
            }
            
            .tetris-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* Wer bin ich? Rätsel Styles */
        .riddle-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }

        .riddle-start {
            padding: 20px;
        }

        .riddle-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .riddle-start h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 15px 0;
            color: #1d1d1f;
        }

        .riddle-start p {
            font-size: 1.1rem;
            color: #6e6e73;
            margin: 10px 0;
        }

        .riddle-header {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .riddle-progress, .riddle-score {
            font-size: 1.1rem;
            font-weight: 600;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 2px solid #e5e5e7;
        }

        .riddle-progress {
            color: #007aff;
        }

        .riddle-score {
            color: #30d158;
        }

        .hints-container {
            margin: 30px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .hint-card {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(0, 122, 255, 0.05));
            border: 2px solid rgba(0, 122, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: left;
            animation: hintReveal 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        .hint-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: hintShimmer 1.5s ease-out;
        }

        .hint-number {
            font-size: 1rem;
            font-weight: 700;
            color: #007aff;
            margin-bottom: 8px;
        }

        .hint-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1d1d1f;
            line-height: 1.4;
        }

        .riddle-input-container {
            margin: 30px 0;
        }

        .riddle-input {
            width: 100%;
            max-width: 400px;
            padding: 16px 20px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            font-size: 1.1rem;
            background: white;
            transition: all 0.2s ease;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        .riddle-input:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transform: scale(1.02);
        }

        .riddle-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .riddle-results {
            padding: 30px;
        }

        .riddle-answer-reveal {
            background: rgba(48, 209, 88, 0.1);
            border: 2px solid #30d158;
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }

        .correct-answer {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1d4ed8;
            margin-bottom: 15px;
            text-align: center;
        }

        .answer-explanation {
            font-size: 1.1rem;
            color: #1d1d1f;
            line-height: 1.5;
        }

        .riddle-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .riddle-stat {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .riddle-performance {
            font-size: 1.1rem;
            color: #6e6e73;
            margin-top: 20px;
            line-height: 1.5;
            padding: 20px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
        }

        @keyframes hintReveal {
            0% { 
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            100% { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes hintShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Responsive Anpassungen für Rätsel */
        @media (max-width: 768px) {
            .riddle-header {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .riddle-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .riddle-buttons .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .riddle-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .riddle-input {
                font-size: 1rem;
            }
        }

        /* Begründung bauen Styles */
        .reasoning-scenario {
            background: rgba(0, 122, 255, 0.05);
            border: 2px solid rgba(0, 122, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin: 25px 0;
        }

        .reasoning-scenario h4 {
            margin: 0 0 15px 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: #1d1d1f;
        }

        .reasoning-scenario p {
            margin: 0;
            font-size: 1.1rem;
            line-height: 1.5;
            color: #1d1d1f;
        }

        .reasoning-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .reasoning-target {
            background: rgba(48, 209, 88, 0.05);
            border: 2px solid rgba(48, 209, 88, 0.2);
            border-radius: 16px;
            padding: 25px;
        }

        .reasoning-target h4 {
            margin: 0 0 20px 0;
            font-size: 1.1rem;
            font-weight: 700;
            color: #1d1d1f;
        }

        .reasoning-slots {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .reasoning-slot {
            display: flex;
            align-items: center;
            background: white;
            border: 3px dashed #c7c7cc;
            border-radius: 12px;
            padding: 20px;
            min-height: 60px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .reasoning-slot.drag-over {
            border-color: #30d158;
            background: rgba(48, 209, 88, 0.1);
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(48, 209, 88, 0.2);
        }

        .reasoning-slot.filled {
            border-color: #30d158;
            border-style: solid;
            background: rgba(48, 209, 88, 0.1);
        }

        .slot-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: #30d158;
            margin-right: 15px;
            min-width: 25px;
        }

        .slot-content {
            flex: 1;
            font-size: 1rem;
            color: #6e6e73;
            font-style: italic;
        }

        .slot-content.filled {
            color: #1d1d1f;
            font-style: normal;
            font-weight: 500;
        }

        .reasoning-blocks {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 25px;
        }

        .reasoning-blocks h4 {
            margin: 0 0 20px 0;
            font-size: 1.1rem;
            font-weight: 700;
            color: #1d1d1f;
        }

        .blocks-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .reasoning-block {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            padding: 18px 20px;
            cursor: grab;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            position: relative;
            transform: translateZ(0);
        }

        .reasoning-block:hover {
            border-color: #007aff;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.15);
        }

        .reasoning-block:active {
            cursor: grabbing;
        }

        .reasoning-block.dragging {
            opacity: 0.8;
            transform: rotate(2deg) scale(1.05);
            z-index: 1000;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .reasoning-block.used {
            opacity: 0.5;
            pointer-events: none;
            background: #f5f5f7;
            border-color: #c7c7cc;
        }

        .block-icon {
            font-size: 1.4rem;
            margin-right: 12px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .block-text {
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.4;
            color: #1d1d1f;
        }

        .reasoning-preview {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e5e5e7;
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }

        .reasoning-preview h4 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            font-weight: 700;
            color: #1d1d1f;
        }

        .preview-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #1d1d1f;
            background: rgba(0, 122, 255, 0.05);
            border-left: 4px solid #007aff;
            padding: 20px;
            border-radius: 8px;
            font-style: italic;
        }

        /* Responsive Anpassungen für Begründung bauen */
        @media (max-width: 768px) {
            .reasoning-container {
                gap: 20px;
            }
            
            .blocks-container {
                grid-template-columns: 1fr;
            }
            
            .reasoning-slot {
                padding: 15px;
                min-height: 50px;
            }
            
            .reasoning-block {
                padding: 15px;
            }
            
            .block-text {
                font-size: 0.95rem;
            }
        }

        /* Paragraphen-Schießen Styles */
        .shooting-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .shooting-start {
            padding: 20px;
        }

        .shooting-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .shooting-start h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 15px 0;
            color: #1d1d1f;
        }

        .shooting-start p {
            font-size: 1.1rem;
            color: #6e6e73;
            margin: 10px 0;
        }

        .shooting-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .shooting-score, .shooting-progress, .shooting-lives {
            font-size: 1.1rem;
            font-weight: 600;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 2px solid #e5e5e7;
        }

        .shooting-score {
            color: #30d158;
        }

        .shooting-progress {
            color: #007aff;
        }

        .shooting-lives {
            color: #ff3b30;
        }

        .statement-display {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(0, 122, 255, 0.05));
            border: 2px solid rgba(0, 122, 255, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .statement-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: statementShimmer 3s ease-in-out infinite;
        }

        .statement-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1d1d1f;
            line-height: 1.4;
            position: relative;
            z-index: 2;
        }

        .shooting-game-area {
            position: relative;
            height: 350px;
            background: linear-gradient(135deg, #f5f5f7, #e8e8ea);
            border-radius: 16px;
            border: 3px solid #e5e5e7;
            margin: 20px 0;
            overflow: hidden;
        }

        .flying-paragraph {
            position: absolute;
            background: linear-gradient(135deg, #007aff, #0056cc);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: paragraphFloat 0.8s ease-in-out infinite alternate;
        }

        .flying-paragraph:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
        }

        .flying-paragraph.correct-hit {
            background: linear-gradient(135deg, #30d158, #28a745);
            animation: correctHit 0.6s ease-out;
        }

        .flying-paragraph.incorrect-hit {
            background: linear-gradient(135deg, #ff3b30, #dc2626);
            animation: incorrectHit 0.6s ease-out;
        }

        .flying-paragraph.missed {
            opacity: 0.5;
            animation: missedParagraph 0.5s ease-out;
        }

        @keyframes paragraphFloat {
            0% { transform: translateY(0px) rotate(-1deg); }
            100% { transform: translateY(-3px) rotate(1deg); }
        }

        @keyframes correctHit {
            0% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(10deg); }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        @keyframes incorrectHit {
            0% { transform: scale(1); }
            25% { transform: scale(1.1) translateX(-5px); }
            75% { transform: scale(1.1) translateX(5px); }
            100% { transform: scale(0.8); opacity: 0.3; }
        }

        @keyframes missedParagraph {
            0% { opacity: 1; }
            100% { opacity: 0; transform: scale(0.8); }
        }

        @keyframes statementShimmer {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .shooting-instructions {
            background: rgba(0, 122, 255, 0.05);
            border: 1px solid rgba(0, 122, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
        }

        .shooting-instructions p {
            margin: 0;
            color: #1d1d1f;
            font-size: 0.95rem;
        }

        .shooting-results {
            padding: 30px;
        }

        .shooting-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .shooting-stat {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .shooting-results-message {
            font-size: 1.1rem;
            color: #6e6e73;
            margin-top: 20px;
            line-height: 1.5;
        }

        /* Responsive Anpassungen für Paragraphen-Schießen */
        @media (max-width: 768px) {
            .shooting-header {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .shooting-game-area {
                height: 300px;
            }
            
            .flying-paragraph {
                font-size: 0.9rem;
                padding: 10px 16px;
            }
            
            .statement-text {
                font-size: 1.1rem;
            }
            
            .shooting-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* Escape Game Styles */
        .escape-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }

        .lock-display {
            text-align: center;
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(0, 122, 255, 0.05));
            border: 2px solid rgba(0, 122, 255, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .lock-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: lockShimmer 3s ease-in-out infinite;
        }

        .lock-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .lock-icon.unlocked {
            transform: scale(1.2) rotate(10deg);
            animation: unlockBounce 0.8s ease-out;
        }

        .lock-status {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 10px;
            transition: color 0.5s ease;
        }

        .lock-status.unlocked {
            color: #30d158;
        }

        .lock-progress {
            font-size: 1.1rem;
            color: #6e6e73;
            font-weight: 500;
        }

        .puzzles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .puzzle-card {
            background: white;
            border: 2px solid #e5e5e7;
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .puzzle-card:hover {
            border-color: #007aff;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.15);
        }

        .puzzle-card.solved {
            border-color: #30d158;
            background: rgba(48, 209, 88, 0.05);
            animation: puzzleSolved 0.6s ease-out;
        }

        .puzzle-card.solved::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(48, 209, 88, 0.1) 50%, transparent 70%);
            animation: solvedShimmer 1s ease-out;
        }

        .puzzle-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e5e7;
        }

        .puzzle-icon {
            font-size: 1.5rem;
            margin-right: 10px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .puzzle-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1d1d1f;
            flex: 1;
        }

        .puzzle-status {
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .puzzle-status.solved {
            animation: statusSolved 0.5s ease-out;
        }

        .puzzle-content {
            margin: 15px 0;
        }

        .puzzle-content p {
            font-size: 1rem;
            color: #1d1d1f;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        /* Eingabefelder für Rätsel */
        .paragraph-input {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            margin: 15px 0;
        }

        .paragraph-input span {
            font-weight: 600;
            color: #1d1d1f;
        }

        .paragraph-input input {
            width: 60px;
            padding: 8px 12px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .paragraph-input input:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .number-input, .calculation-input {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            margin: 15px 0;
        }

        .number-input input, .calculation-input input {
            width: 100px;
            padding: 10px 15px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .number-input input:focus, .calculation-input input:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .number-input span, .calculation-input span {
            font-weight: 600;
            color: #1d1d1f;
            font-size: 1.1rem;
        }

        /* Mini-Sortierung */
        .mini-sortable {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 15px 0;
        }

        .mini-item {
            background: #f5f5f7;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: grab;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            user-select: none;
        }

        .mini-item:hover {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.05);
            transform: translateY(-2px);
        }

        .mini-item:active {
            cursor: grabbing;
        }

        .mini-item.dragging {
            opacity: 0.7;
            transform: rotate(2deg) scale(1.05);
            z-index: 1000;
        }

        /* Wahr/Falsch Buttons */
        .true-false-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .tf-btn {
            padding: 12px 20px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            background: #f5f5f7;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            font-weight: 600;
            min-width: 80px;
        }

        .tf-btn:hover {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.05);
        }

        .tf-btn.selected {
            border-color: #007aff;
            background: #007aff;
            color: white;
        }

        /* Puzzle Button */
        .puzzle-btn {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: #007aff;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 15px;
        }

        .puzzle-btn:hover {
            background: #0056cc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .puzzle-btn:disabled {
            background: #c7c7cc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Erfolgs-Animation */
        .success-animation {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, rgba(48, 209, 88, 0.1), rgba(48, 209, 88, 0.05));
            border: 2px solid rgba(48, 209, 88, 0.3);
            border-radius: 20px;
            margin: 30px 0;
            animation: successReveal 0.8s ease-out;
        }

        .success-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: successBounce 1s ease-out;
        }

        .success-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: #30d158;
            margin-bottom: 15px;
        }

        .success-message {
            font-size: 1.2rem;
            color: #1d1d1f;
            line-height: 1.5;
        }

        /* Animationen */
        @keyframes lockShimmer {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        @keyframes unlockBounce {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(15deg); }
            100% { transform: scale(1.2) rotate(10deg); }
        }

        @keyframes puzzleSolved {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @keyframes solvedShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes statusSolved {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        @keyframes successReveal {
            0% { 
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            100% { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes successBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        /* Responsive Anpassungen für Escape Game */
        @media (max-width: 768px) {
            .puzzles-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .puzzle-card {
                padding: 15px;
            }
            
            .lock-display {
                padding: 20px;
            }
            
            .lock-icon {
                font-size: 3rem;
            }
            
            .success-icon {
                font-size: 4rem;
            }
            
            .success-title {
                font-size: 1.8rem;
            }
            
            .true-false-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .tf-btn {
                width: 100%;
                max-width: 200px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .matching-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 id="platform-title">Steuerrecht Lernkontrolle</h1>
    <p id="welcome-text">Willkommen zur interaktiven Lernkontrolle</p>
   </div>
   <div class="progress-container">
    <div class="progress-bar">
     <div class="progress-fill" id="progress-fill"></div>
    </div>
    <div class="progress-text" id="progress-text">
     Aufgabe 0 von 11
    </div>
   </div><!-- Aufgabe 1: Lückentext -->
   <div class="task-card active" id="task-1">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 1
     </div>
     <div class="task-type">
      Lückentext
     </div>
    </div>
    <div class="task-question">
     Vervollständigen Sie den folgenden Satz über die Umsatzsteuer:
    </div>
    <p style="font-size: 1.1rem; line-height: 1.6;">Die Umsatzsteuer beträgt in Deutschland regulär <span class="gap-text" id="gap-1" contenteditable="true" placeholder="___%"></span> und ermäßigt <span class="gap-text" id="gap-2" contenteditable="true" placeholder="___%"></span>. Unternehmen mit einem Jahresumsatz unter <span class="gap-text" id="gap-3" contenteditable="true" placeholder="_____ €"></span> können die Kleinunternehmerregelung nutzen.</p>
    <div class="feedback" id="feedback-1"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask1()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 2: Multiple Choice -->
   <div class="task-card" id="task-2">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 2
     </div>
     <div class="task-type">
      Multiple Choice
     </div>
    </div>
    <div class="task-question">
     Welche Ausgaben können als Werbungskosten geltend gemacht werden? (Mehrfachauswahl möglich)
    </div>
    <div class="options-grid">
     <div class="option-button" onclick="selectOption(this, 'a')">
      Fahrtkosten zur Arbeit
     </div>
     <div class="option-button" onclick="selectOption(this, 'b')">
      Fortbildungskosten
     </div>
     <div class="option-button" onclick="selectOption(this, 'c')">
      Arbeitskleidung
     </div>
     <div class="option-button" onclick="selectOption(this, 'd')">
      Alle genannten
     </div>
    </div>
    <div class="feedback" id="feedback-2"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask2()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 3: Drag & Drop Sortierung - KOMPLETT NEU -->
   <div class="task-card" id="task-3">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 3
     </div>
     <div class="task-type">
      Sortierung
     </div>
    </div>
    <div class="task-question">
     Sortieren Sie die Steuerklassen nach der Höhe der Steuerbelastung (niedrigste zuerst):
    </div>
    <div class="sortable-container" id="sortable-container">
     <div class="sortable-item" data-order="3">
      Steuerklasse I (ledig)
     </div>
     <div class="sortable-item" data-order="1">
      Steuerklasse III (verheiratet, Alleinverdiener)
     </div>
     <div class="sortable-item" data-order="4">
      Steuerklasse IV (verheiratet, beide berufstätig)
     </div>
     <div class="sortable-item" data-order="2">
      Steuerklasse V (verheiratet, Zweitverdiener)
     </div>
    </div>
    <div class="feedback" id="feedback-3"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask3()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 4: Zuordnung -->
   <div class="task-card" id="task-4">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 4
     </div>
     <div class="task-type">
      Zuordnung
     </div>
    </div>
    <div class="task-question">
     Ziehen Sie die Steuerarten in die entsprechenden Kategorien:
    </div>
    <div class="desktop-only-notice" style="background: rgba(255, 193, 7, 0.1); border: 2px solid rgba(255, 193, 7, 0.3); border-radius: 12px; padding: 15px; margin: 20px 0; text-align: center; display: none;">
     <p style="margin: 0; color: #856404; font-weight: 500;">⚠️ <strong>Hinweis:</strong> Diese Aufgabe funktioniert nur auf Desktop-Geräten mit Maus. Auf mobilen Geräten ist Drag &amp; Drop nicht verfügbar.</p>
    </div>
    <script>
                // Zeige Warnung nur auf Touch-Geräten
                if ('ontouchstart' in window) {
                    document.querySelector('.desktop-only-notice').style.display = 'block';
                }
            </script><!-- Kategorien oben -->
    <div class="category-container">
     <div class="drop-zone" data-category="direkt" id="zone-direkt">
      <h4>Direkte Steuern</h4>
      <p class="category-description">Steuern, die direkt vom Einkommen oder Vermögen erhoben werden</p>
      <div class="dropped-items" id="dropped-direkt"></div>
     </div>
     <div class="drop-zone" data-category="indirekt" id="zone-indirekt">
      <h4>Indirekte Steuern</h4>
      <p class="category-description">Steuern, die über den Konsum oder Verbrauch erhoben werden</p>
      <div class="dropped-items" id="dropped-indirekt"></div>
     </div>
    </div><!-- Begriffe unten -->
    <div class="terms-container">
     <h4>Steuerarten (ziehen Sie diese in die passenden Kategorien)</h4>
     <div class="draggable-terms" id="draggable-terms">
      <div class="draggable-term" data-category="direkt" draggable="true" id="term-einkommensteuer"><span class="term-icon">💰</span> Einkommensteuer
      </div>
      <div class="draggable-term" data-category="indirekt" draggable="true" id="term-mehrwertsteuer"><span class="term-icon">🛒</span> Mehrwertsteuer
      </div>
      <div class="draggable-term" data-category="direkt" draggable="true" id="term-koerperschaftsteuer"><span class="term-icon">🏢</span> Körperschaftsteuer
      </div>
      <div class="draggable-term" data-category="indirekt" draggable="true" id="term-mineraloelsteuer"><span class="term-icon">⛽</span> Mineralölsteuer
      </div>
     </div>
    </div>
    <div class="feedback" id="feedback-4"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask4()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 5: Slider/Berechnung -->
   <div class="task-card" id="task-5">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 5
     </div>
     <div class="task-type">
      Berechnung
     </div>
    </div>
    <div class="task-question">
     Stellen Sie den Steuersatz für ein zu versteuerndes Einkommen von 45.000 € ein:
    </div>
    <div class="slider-container"><input type="range" min="0" max="45" value="20" class="slider" id="tax-slider" oninput="updateSliderValue(this.value)">
     <div class="slider-value" id="slider-value">
      20%
     </div>
    </div>
    <p style="text-align: center; color: #6e6e73; margin-top: 15px;">Hinweis: Der Eingangssteuersatz beträgt 14%, der Spitzensteuersatz 42%</p>
    <div class="feedback" id="feedback-5"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask5()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 6: Wahr/Falsch -->
   <div class="task-card" id="task-6">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 6
     </div>
     <div class="task-type">
      Wahr/Falsch
     </div>
    </div>
    <div class="task-question">
     Bewerten Sie folgende Aussage: "Die Kirchensteuer wird nur von der Einkommensteuer erhoben."
    </div>
    <div class="options-grid">
     <div class="option-button" onclick="selectTrueFalse(this, true)">
      ✓ Wahr
     </div>
     <div class="option-button" onclick="selectTrueFalse(this, false)">
      ✗ Falsch
     </div>
    </div>
    <div class="feedback" id="feedback-6"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask6()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 7: Verbindung -->
   <div class="task-card" id="task-7">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 7
     </div>
     <div class="task-type">
      Verbindung
     </div>
    </div>
    <div class="task-question">
     Verbinden Sie die Steuerarten mit ihren jeweiligen Steuersätzen:
    </div>
    <div class="connection-container">
     <div class="connection-column left-column">
      <h4>Steuerarten</h4>
      <div class="connection-item" data-id="umsatzsteuer" id="left-umsatzsteuer"><span class="connection-text">Umsatzsteuer (regulär)</span> <span class="connection-dot" data-side="right"></span>
      </div>
      <div class="connection-item" data-id="umsatzsteuer-ermaessigt" id="left-umsatzsteuer-ermaessigt"><span class="connection-text">Umsatzsteuer (ermäßigt)</span> <span class="connection-dot" data-side="right"></span>
      </div>
      <div class="connection-item" data-id="spitzensteuersatz" id="left-spitzensteuersatz"><span class="connection-text">Spitzensteuersatz</span> <span class="connection-dot" data-side="right"></span>
      </div>
      <div class="connection-item" data-id="eingangssteuersatz" id="left-eingangssteuersatz"><span class="connection-text">Eingangssteuersatz</span> <span class="connection-dot" data-side="right"></span>
      </div>
     </div>
     <div class="connection-lines" id="connection-lines"><!-- Verbindungslinien werden hier dynamisch eingefügt -->
     </div><!-- SVG für Verbindungslinien über dem gesamten Container -->
     <svg class="connection-svg" width="100%" height="100%" style="position: absolute; top: 0; left: 0; pointer-events: none; z-index: 5;"><!-- Verbindungslinien werden hier dynamisch eingefügt -->
     </svg>
     <div class="connection-column right-column">
      <h4>Steuersätze</h4>
      <div class="connection-item" data-id="19-prozent" id="right-19-prozent"><span class="connection-dot" data-side="left"></span> <span class="connection-text">19%</span>
      </div>
      <div class="connection-item" data-id="7-prozent" id="right-7-prozent"><span class="connection-dot" data-side="left"></span> <span class="connection-text">7%</span>
      </div>
      <div class="connection-item" data-id="42-prozent" id="right-42-prozent"><span class="connection-dot" data-side="left"></span> <span class="connection-text">42%</span>
      </div>
      <div class="connection-item" data-id="14-prozent" id="right-14-prozent"><span class="connection-dot" data-side="left"></span> <span class="connection-text">14%</span>
      </div>
     </div>
    </div>
    <div class="connection-instructions">
     <p>💡 <strong>Anleitung:</strong> Klicken Sie auf einen Punkt links, dann auf den passenden Punkt rechts, um eine Verbindung zu erstellen.</p>
    </div>
    <div class="feedback" id="feedback-7"></div>
    <div class="action-buttons"><button class="btn btn-secondary" onclick="resetConnections()">Zurücksetzen</button> <button class="btn btn-primary" onclick="checkTask7()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 8: Speed-Quiz -->
   <div class="task-card" id="task-8">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 8
     </div>
     <div class="task-type">
      Speed-Quiz
     </div>
    </div>
    <div class="task-question">
     Beantworten Sie die Fragen so schnell wie möglich! Sie haben 3 Sekunden pro Frage.
    </div><!-- Speed Quiz Interface -->
    <div class="speed-quiz-container" id="speed-quiz-container"><!-- Start Screen -->
     <div class="speed-quiz-start" id="speed-quiz-start">
      <div class="speed-quiz-icon">
       ⚡
      </div>
      <h3>Speed-Quiz bereit!</h3>
      <p>5 schnelle Fragen zum Steuerrecht</p>
      <p><strong>Regel:</strong> 3 Sekunden pro Frage</p><button class="btn btn-primary" onclick="startSpeedQuiz()">Quiz starten</button>
     </div><!-- Quiz Screen -->
     <div class="speed-quiz-active" id="speed-quiz-active" style="display: none;">
      <div class="speed-quiz-header">
       <div class="quiz-progress"><span id="current-question">1</span> / <span id="total-questions">10</span>
       </div>
       <div class="quiz-timer">
        <div class="timer-circle" id="timer-circle"><span id="timer-text">3</span>
        </div>
       </div>
       <div class="quiz-score">
        Score: <span id="quiz-score">0</span>
       </div>
      </div>
      <div class="speed-question" id="speed-question">
       Frage wird hier angezeigt...
      </div>
      <div class="speed-options"><button class="speed-option" id="option-a" onclick="answerSpeedQuestion('a')">Option A</button> <button class="speed-option" id="option-b" onclick="answerSpeedQuestion('b')">Option B</button>
      </div>
      <div class="speed-feedback" id="speed-feedback"></div>
     </div><!-- Results Screen -->
     <div class="speed-quiz-results" id="speed-quiz-results" style="display: none;">
      <div class="results-icon" id="results-icon">
       🎯
      </div>
      <h3 id="results-title">Quiz beendet!</h3>
      <div class="results-stats">
       <div class="result-stat">
        <div class="stat-number" id="final-score">
         0
        </div>
        <div class="stat-label">
         Punkte
        </div>
       </div>
       <div class="result-stat">
        <div class="stat-number" id="correct-count">
         0
        </div>
        <div class="stat-label">
         Richtig
        </div>
       </div>
       <div class="result-stat">
        <div class="stat-number" id="average-time">
         0.0s
        </div>
        <div class="stat-label">
         ⌀ Zeit
        </div>
       </div>
      </div>
      <div class="results-message" id="results-message"></div>
     </div>
    </div>
    <div class="feedback" id="feedback-8"></div>
   </div><!-- Aufgabe 9: Steuer-Tetris -->
   <div class="task-card" id="task-9">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 9
     </div>
     <div class="task-type">
      Steuer-Tetris
     </div>
    </div>
    <div class="task-question">
     Ordnen Sie die fallenden Begriffe den richtigen Kategorien zu! Verwenden Sie die Pfeiltasten ← → zum Steuern.
    </div><!-- Tetris Game Container -->
    <div class="tetris-container" id="tetris-container"><!-- Start Screen -->
     <div class="tetris-start" id="tetris-start">
      <div class="tetris-icon">
       🎮
      </div>
      <h3>Steuer-Tetris bereit!</h3>
      <p>Ordnen Sie 10 Steuerbegriffe den richtigen Kategorien zu</p>
      <p><strong>Steuerung:</strong> <span class="desktop-start-controls">← → Pfeiltasten zum Steuern, ↓ schneller fallen</span> <span class="mobile-start-controls" style="display: none;">Wischbewegungen zum Steuern: ← → ↓</span></p>
      <script>
                        // Zeige passende Steuerungsanleitung im Startbildschirm
                        if ('ontouchstart' in window) {
                            const desktopStartControls = document.querySelector('.desktop-start-controls');
                            const mobileStartControls = document.querySelector('.mobile-start-controls');
                            if (desktopStartControls) desktopStartControls.style.display = 'none';
                            if (mobileStartControls) mobileStartControls.style.display = 'inline';
                        }
                    </script><button class="btn btn-primary" onclick="startTetris()">Spiel starten</button>
     </div><!-- Game Screen -->
     <div class="tetris-game" id="tetris-game" style="display: none;">
      <div class="tetris-header">
       <div class="tetris-score">
        Score: <span id="tetris-score">0</span>
       </div>
       <div class="tetris-progress">
        Begriff <span id="current-term">1</span> / <span id="total-terms">10</span>
       </div>
       <div class="tetris-lives">
        Leben: <span id="tetris-lives">❤️❤️❤️</span>
       </div>
      </div><!-- Game Area -->
      <div class="tetris-game-area"><!-- Falling Term -->
       <div class="falling-term" id="falling-term">
        <div class="term-content" id="term-content">
         Begriff
        </div>
       </div><!-- Drop Zones -->
       <div class="tetris-zones">
        <div class="tetris-zone" data-category="betriebsausgabe" id="zone-betriebsausgabe">
         <h4>Betriebsausgabe</h4>
         <p>Abziehbare Geschäftskosten</p>
         <div class="zone-indicator"></div>
        </div>
        <div class="tetris-zone" data-category="nicht-abziehbar" id="zone-nicht-abziehbar">
         <h4>Nicht abziehbar</h4>
         <p>Private oder nicht absetzbare Ausgaben</p>
         <div class="zone-indicator"></div>
        </div>
       </div>
      </div>
      <div class="tetris-instructions">
       <p>💡 <strong>Steuerung:</strong> <span class="desktop-controls">← → Pfeiltasten zum Steuern, ↓ für schnelleres Fallen</span> <span class="mobile-controls" style="display: none;">Wischen Sie ← → zum Steuern, ↓ für schnelleres Fallen</span></p>
      </div>
      <script>
                        // Zeige passende Steuerungsanleitung basierend auf Gerät
                        if ('ontouchstart' in window) {
                            const desktopControls = document.querySelector('.desktop-controls');
                            const mobileControls = document.querySelector('.mobile-controls');
                            if (desktopControls) desktopControls.style.display = 'none';
                            if (mobileControls) mobileControls.style.display = 'inline';
                        }
                    </script>
     </div><!-- Results Screen -->
     <div class="tetris-results" id="tetris-results" style="display: none;">
      <div class="results-icon" id="tetris-results-icon">
       🎯
      </div>
      <h3 id="tetris-results-title">Spiel beendet!</h3>
      <div class="tetris-stats">
       <div class="tetris-stat">
        <div class="stat-number" id="tetris-final-score">
         0
        </div>
        <div class="stat-label">
         Punkte
        </div>
       </div>
       <div class="tetris-stat">
        <div class="stat-number" id="tetris-correct-count">
         0
        </div>
        <div class="stat-label">
         Richtig
        </div>
       </div>
       <div class="tetris-stat">
        <div class="stat-number" id="tetris-accuracy">
         0%
        </div>
        <div class="stat-label">
         Genauigkeit
        </div>
       </div>
      </div>
      <div class="tetris-results-message" id="tetris-results-message"></div>
     </div>
    </div>
    <div class="feedback" id="feedback-9"></div>
   </div><!-- Aufgabe 10: Wer bin ich? -->
   <div class="task-card" id="task-10">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 10
     </div>
     <div class="task-type">
      Wer bin ich?
     </div>
    </div>
    <div class="task-question">
     Erraten Sie den Fachbegriff anhand der Hinweise!
    </div><!-- Riddle Game Container -->
    <div class="riddle-container" id="riddle-container"><!-- Start Screen -->
     <div class="riddle-start" id="riddle-start">
      <div class="riddle-icon">
       🕵️
      </div>
      <h3>Wer bin ich?</h3>
      <p>Erraten Sie den Steuerfachbegriff anhand von Hinweisen</p>
      <p><strong>Regel:</strong> Sie erhalten bis zu 3 Hinweise - je früher Sie raten, desto mehr Punkte!</p><button class="btn btn-primary" onclick="startRiddle()">Rätsel starten</button>
     </div><!-- Game Screen -->
     <div class="riddle-game" id="riddle-game" style="display: none;">
      <div class="riddle-header">
       <div class="riddle-progress">
        Hinweis <span id="current-hint">1</span> / <span id="total-hints">3</span>
       </div>
       <div class="riddle-score">
        Mögliche Punkte: <span id="possible-points">3</span>
       </div>
      </div><!-- Hints Display -->
      <div class="hints-container">
       <div class="hint-card" id="hint-1" style="display: none;">
        <div class="hint-number">
         💡 Hinweis 1
        </div>
        <div class="hint-text">
         Ich mindere das zu versteuernde Einkommen
        </div>
       </div>
       <div class="hint-card" id="hint-2" style="display: none;">
        <div class="hint-number">
         💡 Hinweis 2
        </div>
        <div class="hint-text">
         Ich bin keine Ausgabe
        </div>
       </div>
       <div class="hint-card" id="hint-3" style="display: none;">
        <div class="hint-number">
         💡 Hinweis 3
        </div>
        <div class="hint-text">
         Ich werde nur virtuell gebildet
        </div>
       </div>
      </div><!-- Answer Input -->
      <div class="riddle-input-container"><input type="text" class="riddle-input" id="riddle-answer" placeholder="Ihre Antwort eingeben..." maxlength="50">
       <div class="riddle-buttons"><button class="btn btn-secondary" onclick="showNextHint()" id="hint-btn">Nächster Hinweis</button> <button class="btn btn-primary" onclick="checkRiddleAnswer()">Antwort prüfen</button>
       </div>
      </div>
     </div><!-- Results Screen -->
     <div class="riddle-results" id="riddle-results" style="display: none;">
      <div class="results-icon" id="riddle-results-icon">
       🎯
      </div>
      <h3 id="riddle-results-title">Rätsel gelöst!</h3>
      <div class="riddle-answer-reveal">
       <div class="correct-answer"><strong>Lösung: Rückstellung</strong>
       </div>
       <div class="answer-explanation">
        Eine Rückstellung ist eine bilanzielle Vorsorge für ungewisse Verbindlichkeiten. Sie mindert das zu versteuernde Einkommen, ohne dass tatsächlich Geld ausgegeben wird - sie wird nur "virtuell" in der Buchhaltung gebildet.
       </div>
      </div>
      <div class="riddle-stats">
       <div class="riddle-stat">
        <div class="stat-number" id="riddle-final-points">
         0
        </div>
        <div class="stat-label">
         Punkte erhalten
        </div>
       </div>
       <div class="riddle-stat">
        <div class="stat-number" id="riddle-hints-used">
         0
        </div>
        <div class="stat-label">
         Hinweise verwendet
        </div>
       </div>
      </div>
      <div class="riddle-performance" id="riddle-performance"></div>
     </div>
    </div>
    <div class="feedback" id="feedback-10"></div>
   </div><!-- Aufgabe 11: Begründung bauen -->
   <div class="task-card" id="task-11">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 11
     </div>
     <div class="task-type">
      Begründung bauen
     </div>
    </div>
    <div class="task-question">
     Setzen Sie die Bausteine zu einer korrekten rechtlichen Begründung zusammen:
    </div>
    <div class="reasoning-scenario">
     <h4>📋 Sachverhalt:</h4>
     <p>Ein Krankenhaus erbringt medizinische Heilbehandlungen an Patienten. Ist diese Leistung umsatzsteuerpflichtig?</p>
    </div><!-- Begründung bauen Container -->
    <div class="reasoning-container" id="reasoning-container"><!-- Ziel-Bereich für die Begründung -->
     <div class="reasoning-target">
      <h4>🎯 Ihre Begründung (ziehen Sie die Bausteine hierher):</h4>
      <div class="reasoning-slots" id="reasoning-slots">
       <div class="reasoning-slot" data-position="1"><span class="slot-number">1.</span>
        <div class="slot-content" id="slot-1">
         Baustein hier ablegen...
        </div>
       </div>
       <div class="reasoning-slot" data-position="2"><span class="slot-number">2.</span>
        <div class="slot-content" id="slot-2">
         Baustein hier ablegen...
        </div>
       </div>
       <div class="reasoning-slot" data-position="3"><span class="slot-number">3.</span>
        <div class="slot-content" id="slot-3">
         Baustein hier ablegen...
        </div>
       </div>
      </div>
     </div><!-- Verfügbare Bausteine -->
     <div class="reasoning-blocks">
      <h4>🧩 Verfügbare Bausteine (ziehen Sie diese in die richtige Reihenfolge):</h4>
      <div class="blocks-container" id="blocks-container">
       <div class="reasoning-block" data-correct-position="2" draggable="true" id="block-1"><span class="block-icon">⚖️</span> <span class="block-text">ist dieser Umsatz steuerfrei, weil es sich um eine</span>
       </div>
       <div class="reasoning-block" data-correct-position="3" draggable="true" id="block-2"><span class="block-icon">🏥</span> <span class="block-text">Heilbehandlung im Bereich der Humanmedizin handelt.</span>
       </div>
       <div class="reasoning-block" data-correct-position="1" draggable="true" id="block-3"><span class="block-icon">📜</span> <span class="block-text">Nach § 4 Nr. 14 UStG</span>
       </div>
      </div>
     </div>
    </div>
    <div class="reasoning-preview" id="reasoning-preview" style="display: none;">
     <h4>📝 Ihre zusammengesetzte Begründung:</h4>
     <div class="preview-text" id="preview-text"></div>
    </div>
    <div class="feedback" id="feedback-11"></div>
    <div class="action-buttons"><button class="btn btn-secondary" onclick="resetReasoning()">Zurücksetzen</button> <button class="btn btn-primary" onclick="checkTask11()">Antwort prüfen</button>
    </div>
   </div><!-- Aufgabe 12: Paragraphen-Schießen -->
   <div class="task-card" id="task-12">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 12
     </div>
     <div class="task-type">
      Paragraphen-Schießen
     </div>
    </div>
    <div class="task-question">
     Klicken Sie den richtigen Paragraphen an, bevor er wegfliegt! Sie haben 3 Leben.
    </div><!-- Paragraphen-Schießen Container -->
    <div class="shooting-container" id="shooting-container"><!-- Start Screen -->
     <div class="shooting-start" id="shooting-start">
      <div class="shooting-icon">
       🎯
      </div>
      <h3>Paragraphen-Schießen bereit!</h3>
      <p>Treffen Sie die richtigen Paragraphen zu den Aussagen</p>
      <p><strong>Regel:</strong> 3 Leben, 10 Aussagen, Paragraphen fliegen weg!</p><button class="btn btn-primary" onclick="startShooting()">Spiel starten</button>
     </div><!-- Game Screen -->
     <div class="shooting-game" id="shooting-game" style="display: none;">
      <div class="shooting-header">
       <div class="shooting-score">
        Score: <span id="shooting-score">0</span>
       </div>
       <div class="shooting-progress">
        Aussage <span id="current-statement">1</span> / <span id="total-statements">10</span>
       </div>
       <div class="shooting-lives">
        Leben: <span id="shooting-lives">❤️❤️❤️</span>
       </div>
      </div><!-- Statement Display -->
      <div class="statement-display">
       <div class="statement-text" id="statement-text">
        Aussage wird hier angezeigt...
       </div>
      </div><!-- Game Area -->
      <div class="shooting-game-area" id="shooting-game-area"><!-- Flying paragraphs will be inserted here dynamically -->
      </div>
      <div class="shooting-instructions">
       <p>💡 <strong>Anleitung:</strong> Klicken Sie auf den Paragraphen, der zur Aussage passt, bevor er wegfliegt!</p>
      </div>
     </div><!-- Results Screen -->
     <div class="shooting-results" id="shooting-results" style="display: none;">
      <div class="results-icon" id="shooting-results-icon">
       🎯
      </div>
      <h3 id="shooting-results-title">Spiel beendet!</h3>
      <div class="shooting-stats">
       <div class="shooting-stat">
        <div class="stat-number" id="shooting-final-score">
         0
        </div>
        <div class="stat-label">
         Punkte
        </div>
       </div>
       <div class="shooting-stat">
        <div class="stat-number" id="shooting-correct-count">
         0
        </div>
        <div class="stat-label">
         Treffer
        </div>
       </div>
       <div class="shooting-stat">
        <div class="stat-number" id="shooting-accuracy">
         0%
        </div>
        <div class="stat-label">
         Trefferquote
        </div>
       </div>
      </div>
      <div class="shooting-results-message" id="shooting-results-message"></div>
     </div>
    </div>
    <div class="feedback" id="feedback-12"></div>
   </div><!-- Aufgabe 13: Das Schloss öffnen (Escape Game) -->
   <div class="task-card" id="task-13">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 13
     </div>
     <div class="task-type">
      Das Schloss öffnen
     </div>
    </div>
    <div class="task-question">
     Lösen Sie alle 5 Rätsel, um das Schloss zu öffnen und die Lernkontrolle abzuschließen!
    </div><!-- Escape Game Container -->
    <div class="escape-container" id="escape-container"><!-- Schloss Anzeige -->
     <div class="lock-display">
      <div class="lock-icon" id="lock-icon">
       🔒
      </div>
      <div class="lock-status" id="lock-status">
       Schloss verschlossen
      </div>
      <div class="lock-progress"><span id="solved-puzzles">0</span> / 5 Rätsel gelöst
      </div>
     </div><!-- Rätsel Grid -->
     <div class="puzzles-grid" id="puzzles-grid"><!-- Rätsel 1: §-Kombination -->
      <div class="puzzle-card" data-puzzle="1" id="puzzle-1">
       <div class="puzzle-header"><span class="puzzle-icon">📜</span> <span class="puzzle-title">§-Kombination</span> <span class="puzzle-status" id="status-1">🔒</span>
       </div>
       <div class="puzzle-content">
        <p>Welcher Paragraf regelt die Umsatzsteuerbefreiung für Heilbehandlungen?</p>
        <div class="paragraph-input"><span>§</span> <input type="number" id="paragraph-number" min="1" max="50" placeholder="?"> <span>Nr.</span> <input type="number" id="paragraph-subnumber" min="1" max="30" placeholder="?"> <span>UStG</span>
        </div>
       </div><button class="puzzle-btn" onclick="checkPuzzle1()">Prüfen</button>
      </div><!-- Rätsel 2: Zahlencode -->
      <div class="puzzle-card" data-puzzle="2" id="puzzle-2">
       <div class="puzzle-header"><span class="puzzle-icon">🔢</span> <span class="puzzle-title">Zahlencode</span> <span class="puzzle-status" id="status-2">🔒</span>
       </div>
       <div class="puzzle-content">
        <p>Berechnen Sie: Umsatzsteuer (19%) + Ermäßigte Umsatzsteuer (7%) = ?</p>
        <div class="number-input"><input type="number" id="number-code" min="1" max="100" placeholder="Ergebnis"> <span>%</span>
        </div>
       </div><button class="puzzle-btn" onclick="checkPuzzle2()">Prüfen</button>
      </div><!-- Rätsel 3: Sortierung -->
      <div class="puzzle-card" data-puzzle="3" id="puzzle-3">
       <div class="puzzle-header"><span class="puzzle-icon">🔄</span> <span class="puzzle-title">Reihenfolge</span> <span class="puzzle-status" id="status-3">🔒</span>
       </div>
       <div class="puzzle-content">
        <p>Sortieren Sie nach Steuersatz (niedrigster zuerst):</p>
        <div class="mini-sortable" id="mini-sortable">
         <div class="mini-item" data-value="42">
          Spitzensteuersatz
         </div>
         <div class="mini-item" data-value="19">
          Umsatzsteuer
         </div>
         <div class="mini-item" data-value="7">
          Ermäßigte USt
         </div>
         <div class="mini-item" data-value="14">
          Eingangssteuersatz
         </div>
        </div>
       </div><button class="puzzle-btn" onclick="checkPuzzle3()">Prüfen</button>
      </div><!-- Rätsel 4: Richtig/Falsch -->
      <div class="puzzle-card" data-puzzle="4" id="puzzle-4">
       <div class="puzzle-header"><span class="puzzle-icon">✓</span> <span class="puzzle-title">Wahr/Falsch</span> <span class="puzzle-status" id="status-4">🔒</span>
       </div>
       <div class="puzzle-content">
        <p>Aussage: "Die Kleinunternehmerregelung gilt ab 22.000€ Jahresumsatz"</p>
        <div class="true-false-buttons"><button class="tf-btn" data-answer="true" onclick="selectTrueFalse4(this, true)">✓ Wahr</button> <button class="tf-btn" data-answer="false" onclick="selectTrueFalse4(this, false)">✗ Falsch</button>
        </div>
       </div><button class="puzzle-btn" onclick="checkPuzzle4()">Prüfen</button>
      </div><!-- Rätsel 5: Mini-Rechnung -->
      <div class="puzzle-card" data-puzzle="5" id="puzzle-5">
       <div class="puzzle-header"><span class="puzzle-icon">🧮</span> <span class="puzzle-title">Berechnung</span> <span class="puzzle-status" id="status-5">🔒</span>
       </div>
       <div class="puzzle-content">
        <p>Nettobetrag: 100€<br>
         + 19% Umsatzsteuer = ?</p>
        <div class="calculation-input"><input type="number" id="calculation-result" step="0.01" min="0" placeholder="Bruttobetrag"> <span>€</span>
        </div>
       </div><button class="puzzle-btn" onclick="checkPuzzle5()">Prüfen</button>
      </div>
     </div><!-- Erfolgs-Animation -->
     <div class="success-animation" id="success-animation" style="display: none;">
      <div class="success-icon">
       🎉
      </div>
      <div class="success-title">
       Schloss geöffnet!
      </div>
      <div class="success-message">
       Herzlichen Glückwunsch! Sie haben alle Rätsel gelöst!
      </div>
     </div>
    </div>
    <div class="feedback" id="feedback-13"></div>
   </div><!-- Abschlussbildschirm -->
   <div class="completion-screen" id="completion-screen">
    <div class="completion-icon">
     🎉
    </div>
    <div class="completion-title">
     Herzlichen Glückwunsch!
    </div>
    <p id="completion-message">Herzlichen Glückwunsch! Sie haben alle Aufgaben erfolgreich bearbeitet.</p>
    <div class="stats-grid">
     <div class="stat-card">
      <div class="stat-number" id="correct-answers">
       0
      </div>
      <div class="stat-label">
       Richtige Antworten
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="total-attempts">
       0
      </div>
      <div class="stat-label">
       Gesamtversuche
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="success-rate">
       0%
      </div>
      <div class="stat-label">
       Erfolgsquote
      </div>
     </div>
    </div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="restartQuiz()">Erneut starten</button>
    </div>
   </div>
   <div class="action-buttons" id="navigation-buttons"><button class="btn btn-secondary" onclick="previousTask()" id="prev-btn">Vorherige Aufgabe</button> <button class="btn btn-primary" onclick="nextTask()" id="next-btn">Weiter</button>
   </div>
  </div>
  <script>
        let currentTask = 1;
        const totalTasks = 13;
        let completedTasks = 0;
        let userAnswers = {};
        let taskAttempts = {};
        let correctAnswers = 0;
        let totalAttempts = 0;

        // Sortierung - Globale Variablen
        let draggedElement = null;
        let draggedIndex = -1;

        // Konfiguration
        const defaultConfig = {
            platform_title: "Steuerrecht Lernkontrolle",
            welcome_text: "Willkommen zur interaktiven Lernkontrolle",
            completion_message: "Herzlichen Glückwunsch! Sie haben alle Aufgaben erfolgreich bearbeitet."
        };

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                if (data.length > 0) {
                    updateStatsFromData(data);
                }
            }
        };

        // Element SDK Initialisierung
        async function initializeSDKs() {
            if (window.dataSdk) {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Data SDK initialization failed");
                }
            }

            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('platform-title').textContent = config.platform_title || defaultConfig.platform_title;
                        document.getElementById('welcome-text').textContent = config.welcome_text || defaultConfig.welcome_text;
                        document.getElementById('completion-message').textContent = config.completion_message || defaultConfig.completion_message;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["platform_title", config.platform_title || defaultConfig.platform_title],
                        ["welcome_text", config.welcome_text || defaultConfig.welcome_text],
                        ["completion_message", config.completion_message || defaultConfig.completion_message]
                    ])
                });
            }
        }

        // Initialisierung beim Laden der Seite
        document.addEventListener('DOMContentLoaded', function() {
            initializeSDKs();
            updateProgress();
            initializeSortable();
            initializeDragDrop();
            initializeTouchDragDrop(); // Touch-Unterstützung für mobile Geräte
            initializeConnections();
            initializeReasoning();
            initializeEscapeGame();
            setupKeyboardNavigation();
            setupButtonHandlers(); // Button-Handler initialisieren
            updateNavigationButtons(); // Navigation-Buttons initialisieren
        });

        // Separate Funktion für Keyboard Navigation
        function setupKeyboardNavigation() {
            // Enter-Taste Navigation für Lückentext
            const gaps = ['gap-1', 'gap-2', 'gap-3'];
            
            gaps.forEach((gapId, index) => {
                const gapElement = document.getElementById(gapId);
                if (gapElement) {
                    gapElement.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            
                            if (index < gaps.length - 1) {
                                // Zur nächsten Lücke springen
                                const nextGap = document.getElementById(gaps[index + 1]);
                                if (nextGap) {
                                    nextGap.focus();
                                    // Cursor ans Ende setzen
                                    const range = document.createRange();
                                    const selection = window.getSelection();
                                    range.selectNodeContents(nextGap);
                                    range.collapse(false);
                                    selection.removeAllRanges();
                                    selection.addRange(range);
                                }
                            } else {
                                // Bei der letzten Lücke: Antwort prüfen
                                checkTask1();
                            }
                        }
                    });
                }
            });
            
            // Rätsel-Input Navigation
            const riddleInput = document.getElementById('riddle-answer');
            if (riddleInput) {
                riddleInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && riddleGameActive) {
                        checkRiddleAnswer();
                    }
                });
            }
        }

        // Sortierungslogik - nur Desktop
        function initializeSortable() {
            const container = document.getElementById('sortable-container');
            if (!container) return;
            
            const items = container.querySelectorAll('.sortable-item');
            
            items.forEach((item, index) => {
                item.draggable = true;
                item.addEventListener('dragstart', handleSortableDragStart);
                item.addEventListener('dragend', handleSortableDragEnd);
            });
            
            container.addEventListener('dragover', handleSortableDragOver);
            container.addEventListener('drop', handleSortableDrop);
        }

        function handleSortableDragStart(e) {
            draggedElement = this;
            draggedIndex = Array.from(this.parentNode.children).indexOf(this);
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', '');
            
            // Smooth start animation
            setTimeout(() => {
                if (this.classList.contains('dragging')) {
                    this.classList.add('drag-preview');
                }
            }, 100);
        }

        function handleSortableDragEnd(e) {
            if (this.classList.contains('dragging')) {
                this.classList.remove('dragging', 'drag-preview');
                
                // Success animation when dropped
                this.classList.add('drop-success');
                setTimeout(() => {
                    this.classList.remove('drop-success');
                }, 600);
            }
            draggedElement = null;
            draggedIndex = -1;
            clearSortableDragEffects();
        }

        function handleSortableDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            if (!draggedElement) return;
            
            const container = document.getElementById('sortable-container');
            container.classList.add('drag-over');
            
            const afterElement = getSortableDragAfterElement(container, e.clientY);
            
            // Clear previous drag indicators
            clearSortableDragEffects();
            
            // Add smooth insertion animation
            if (afterElement == null) {
                container.appendChild(draggedElement);
            } else {
                container.insertBefore(draggedElement, afterElement);
                // Add insertion indicator to the element we're inserting before
                afterElement.classList.add('drag-over-top');
            }
            
            // Add subtle animation to other elements
            const allItems = container.querySelectorAll('.sortable-item:not(.dragging)');
            allItems.forEach((item, index) => {
                item.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                item.style.transitionDelay = `${index * 0.02}s`;
            });
        }

        function handleSortableDrop(e) {
            e.preventDefault();
            const container = document.getElementById('sortable-container');
            container.classList.remove('drag-over');
            clearSortableDragEffects();
            
            // Gentle settle animation for all items
            const allItems = container.querySelectorAll('.sortable-item');
            allItems.forEach((item, index) => {
                item.style.transition = 'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)';
                item.style.transitionDelay = `${index * 0.02}s`;
                
                // Reset after animation
                setTimeout(() => {
                    item.style.transitionDelay = '';
                }, 250 + (index * 20));
            });
        }

        // Hilfsfunktion: Bestimme Element nach dem eingefügt werden soll
        function getSortableDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.sortable-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Hilfsfunktion: Alle Drag-Effekte entfernen
        function clearSortableDragEffects() {
            document.querySelectorAll('.sortable-item').forEach(item => {
                item.classList.remove('drag-over-top', 'drag-over-bottom');
                // Reset transition delays
                item.style.transitionDelay = '';
            });
            const container = document.getElementById('sortable-container');
            if (container) {
                container.classList.remove('drag-over');
            }
        }

        function updateProgress() {
            const progress = (completedTasks / totalTasks) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Aufgabe ${completedTasks} von ${totalTasks}`;
        }

        function showTask(taskNumber) {
            for (let i = 1; i <= totalTasks; i++) {
                document.getElementById(`task-${i}`).classList.remove('active');
            }
            
            document.getElementById(`task-${taskNumber}`).classList.add('active');
            currentTask = taskNumber;
            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            // Zurück-Button: Sichtbar ab Aufgabe 2
            if (prevBtn) {
                prevBtn.style.display = currentTask > 1 ? 'inline-block' : 'none';
                // Event Listener neu setzen
                prevBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    previousTask();
                };
            }
            
            // Weiter-Button: Immer sichtbar
            if (nextBtn) {
                if (currentTask === totalTasks) {
                    nextBtn.textContent = 'Abschließen';
                    nextBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        showCompletionScreen();
                    };
                } else {
                    nextBtn.textContent = 'Nächste Aufgabe';
                    nextBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        nextTask();
                    };
                }
                nextBtn.style.display = 'inline-block';
            }
        }

        function nextTask() {
            if (currentTask < totalTasks) {
                showTask(currentTask + 1);
            } else if (completedTasks === totalTasks) {
                showCompletionScreen();
            }
        }

        function previousTask() {
            if (currentTask > 1) {
                showTask(currentTask - 1);
            }
        }

        // Aufgabe 1: Lückentext
        function checkTask1() {
            const gap1 = document.getElementById('gap-1').textContent.trim();
            const gap2 = document.getElementById('gap-2').textContent.trim();
            const gap3 = document.getElementById('gap-3').textContent.trim();
            
            const correct1 = gap1 === '19' || gap1 === '19%';
            const correct2 = gap2 === '7' || gap2 === '7%';
            const correct3 = gap3 === '22000' || gap3 === '22.000' || gap3 === '22000€' || gap3 === '22.000€';
            
            const isCorrect = correct1 && correct2 && correct3;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '✅ Richtig! Die Umsatzsteuer beträgt 19% (regulär) und 7% (ermäßigt). Die Kleinunternehmerregelung gilt bis 22.000€.';
            } else {
                feedbackMessage = '❌ Nicht ganz richtig.<br><br><strong>Vollständige Lösung:</strong><br>';
                feedbackMessage += 'Die Umsatzsteuer beträgt in Deutschland regulär <strong>19%</strong> und ermäßigt <strong>7%</strong>. ';
                feedbackMessage += 'Unternehmen mit einem Jahresumsatz unter <strong>22.000 €</strong> können die Kleinunternehmerregelung nutzen.';
            }
            
            showFeedback(1, isCorrect, feedbackMessage);
            saveTaskResult(1, `${gap1}|${gap2}|${gap3}`, isCorrect);
        }
        
        // Sicherstelle dass alle Button-Event-Handler korrekt gesetzt sind
        function setupButtonHandlers() {
            // Aufgabe 1 Button
            const task1Btn = document.querySelector('#task-1 .btn-primary');
            if (task1Btn) {
                task1Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask1();
                };
            }
            
            // Aufgabe 2 Button
            const task2Btn = document.querySelector('#task-2 .btn-primary');
            if (task2Btn) {
                task2Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask2();
                };
            }
            
            // Aufgabe 3 Button
            const task3Btn = document.querySelector('#task-3 .btn-primary');
            if (task3Btn) {
                task3Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask3();
                };
            }
            
            // Aufgabe 4 Button
            const task4Btn = document.querySelector('#task-4 .btn-primary');
            if (task4Btn) {
                task4Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask4();
                };
            }
            
            // Aufgabe 5 Button
            const task5Btn = document.querySelector('#task-5 .btn-primary');
            if (task5Btn) {
                task5Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask5();
                };
            }
            
            // Aufgabe 6 Button
            const task6Btn = document.querySelector('#task-6 .btn-primary');
            if (task6Btn) {
                task6Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask6();
                };
            }
            
            // Aufgabe 7 Button
            const task7Btn = document.querySelector('#task-7 .btn-primary');
            if (task7Btn) {
                task7Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask7();
                };
            }
            
            // Aufgabe 11 Button
            const task11Btn = document.querySelector('#task-11 .btn-primary');
            if (task11Btn) {
                task11Btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    checkTask11();
                };
            }
        }

        // Aufgabe 2: Multiple Choice
        let selectedOptions = [];

        function selectOption(element, option) {
            if (element.classList.contains('selected')) {
                // Option abwählen
                element.classList.remove('selected');
                selectedOptions = selectedOptions.filter(opt => opt !== option);
            } else {
                // Option auswählen
                element.classList.add('selected');
                selectedOptions.push(option);
            }
        }

        function checkTask2() {
            if (selectedOptions.length === 0) {
                showFeedback(2, false, 'Bitte wählen Sie mindestens eine Antwort aus.');
                return;
            }
            
            // Korrekte Antworten: a, b, c (alle außer d)
            const correctOptions = ['a', 'b', 'c'];
            const isCorrect = correctOptions.length === selectedOptions.length && 
                             correctOptions.every(opt => selectedOptions.includes(opt));
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '✅ Richtig! Fahrtkosten zur Arbeit, Fortbildungskosten und Arbeitskleidung können alle als Werbungskosten geltend gemacht werden.';
            } else {
                feedbackMessage = '❌ Nicht alle richtigen Antworten wurden ausgewählt.<br><br><strong>Vollständige Lösung:</strong><br>';
                feedbackMessage += '✓ <strong>Fahrtkosten zur Arbeit</strong> - absetzbar als Werbungskosten<br>';
                feedbackMessage += '✓ <strong>Fortbildungskosten</strong> - absetzbar als Werbungskosten<br>';
                feedbackMessage += '✓ <strong>Arbeitskleidung</strong> - absetzbar als Werbungskosten<br>';
                feedbackMessage += '❌ <strong>Alle genannten</strong> - diese Option ist überflüssig, da die einzelnen Optionen bereits richtig sind';
            }
            
            showFeedback(2, isCorrect, feedbackMessage);
            saveTaskResult(2, selectedOptions.join(','), isCorrect);
        }

        // Aufgabe 3: Sortierung prüfen
        function checkTask3() {
            const container = document.getElementById('sortable-container');
            const items = container.querySelectorAll('.sortable-item');
            const currentOrder = Array.from(items).map(item => item.getAttribute('data-order'));
            const correctOrder = ['1', '2', '3', '4'];
            
            const isCorrect = JSON.stringify(currentOrder) === JSON.stringify(correctOrder);
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '✅ Richtig! Die Reihenfolge entspricht der Steuerbelastung von niedrig zu hoch.';
            } else {
                feedbackMessage = '❌ Falsch.<br><br><strong>Vollständige Lösung (nach Steuerbelastung sortiert):</strong><br>';
                feedbackMessage += '1. <strong>Steuerklasse III</strong> (verheiratet, Alleinverdiener) - niedrigste Belastung<br>';
                feedbackMessage += '2. <strong>Steuerklasse V</strong> (verheiratet, Zweitverdiener)<br>';
                feedbackMessage += '3. <strong>Steuerklasse I</strong> (ledig)<br>';
                feedbackMessage += '4. <strong>Steuerklasse IV</strong> (verheiratet, beide berufstätig) - höchste Belastung';
            }
            
            showFeedback(3, isCorrect, feedbackMessage);
            saveTaskResult(3, currentOrder.join(','), isCorrect);
        }

        // Aufgabe 4: Neue Drag & Drop Zuordnung
        let draggedTerm = null;
        let droppedTerms = { direkt: [], indirekt: [] };

        // Aufgabe 7: Verbindungsaufgabe
        let selectedDot = null;
        let connections = [];
        let isConnecting = false;

        // Initialisierung der Drag & Drop Funktionalität - nur Desktop
        function initializeDragDrop() {
            const terms = document.querySelectorAll('.draggable-term');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            // Drag Events für Begriffe - nur Desktop
            terms.forEach(term => {
                term.addEventListener('dragstart', handleTermDragStart);
                term.addEventListener('dragend', handleTermDragEnd);
            });
            
            // Drop Events für Zonen
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleTermDragStart(e) {
            draggedTerm = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleTermDragEnd(e) {
            this.classList.remove('dragging');
            draggedTerm = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            // Nur entfernen wenn wir die Zone wirklich verlassen
            if (!this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (!draggedTerm) return;
            
            const dropZoneCategory = this.getAttribute('data-category');
            const droppedItemsContainer = this.querySelector('.dropped-items');
            const termId = draggedTerm.id;
            
            // Prüfen ob Begriff bereits woanders zugeordnet ist
            Object.keys(droppedTerms).forEach(category => {
                const index = droppedTerms[category].indexOf(termId);
                if (index > -1) {
                    // Entferne aus alter Kategorie
                    droppedTerms[category].splice(index, 1);
                    // Entferne visuell aus alter Drop-Zone
                    const oldDroppedItem = document.querySelector(`[data-original-id="${termId}"]`);
                    if (oldDroppedItem) {
                        oldDroppedItem.remove();
                    }
                }
            });
            
            // Erstelle neuen Begriff in der Drop-Zone
            const clonedTerm = draggedTerm.cloneNode(true);
            clonedTerm.classList.add('dropped');
            clonedTerm.classList.remove('dragging');
            clonedTerm.draggable = true; // Wieder draggable machen
            clonedTerm.setAttribute('data-original-id', termId);
            
            // Event Listener für das geklonte Element hinzufügen - nur Desktop
            clonedTerm.addEventListener('dragstart', handleDroppedTermDragStart);
            clonedTerm.addEventListener('dragend', handleDroppedTermDragEnd);
            
            // Doppelklick zum Entfernen hinzufügen
            clonedTerm.addEventListener('dblclick', () => removeDroppedTerm(clonedTerm, termId));
            clonedTerm.style.cursor = 'grab';
            clonedTerm.title = 'Doppelklick zum Entfernen oder ziehen zum Verschieben (nur Desktop)';
            
            // Original-Element ausblenden
            draggedTerm.style.display = 'none';
            
            // Füge zur neuen Drop-Zone hinzu
            droppedItemsContainer.appendChild(clonedTerm);
            droppedTerms[dropZoneCategory].push(termId);
            
            // Sanfte Drop-Animation
            setTimeout(() => {
                clonedTerm.classList.add('dropped');
            }, 100);
        }

        // Drag-Handler für bereits zugeordnete Begriffe
        function handleDroppedTermDragStart(e) {
            draggedTerm = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleDroppedTermDragEnd(e) {
            this.classList.remove('dragging');
            draggedTerm = null;
        }

        // Funktion zum Entfernen eines zugeordneten Begriffs
        function removeDroppedTerm(droppedElement, termId) {
            // Entferne aus Datenstruktur
            Object.keys(droppedTerms).forEach(category => {
                const index = droppedTerms[category].indexOf(termId);
                if (index > -1) {
                    droppedTerms[category].splice(index, 1);
                }
            });
            
            // Entferne visuell
            droppedElement.remove();
            
            // Zeige Original-Element wieder an
            const originalTerm = document.getElementById(termId);
            if (originalTerm) {
                originalTerm.style.display = 'flex';
                originalTerm.classList.remove('dropped');
            }
        }

        // Touch Events für mobile Drag & Drop - DEAKTIVIERT
        function initializeTouchDragDrop() {
            // Mobile Touch-Steuerung für Zuordnungsaufgabe deaktiviert
            // Nur Desktop-Drag&Drop verfügbar
            return;
        }

        function checkTask4() {
            const totalDropped = droppedTerms.direkt.length + droppedTerms.indirekt.length;
            const correctDirekt = droppedTerms.direkt.includes('term-einkommensteuer') && 
                                 droppedTerms.direkt.includes('term-koerperschaftsteuer');
            const correctIndirekt = droppedTerms.indirekt.includes('term-mehrwertsteuer') && 
                                   droppedTerms.indirekt.includes('term-mineraloelsteuer');
            
            const isCorrect = totalDropped === 4 && correctDirekt && correctIndirekt;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '✅ Richtig! Alle Steuerarten wurden korrekt zugeordnet.';
            } else {
                feedbackMessage = '❌ Noch nicht alle Zuordnungen sind korrekt.<br><br><strong>Vollständige Lösung:</strong><br>';
                feedbackMessage += '<strong>Direkte Steuern:</strong><br>';
                feedbackMessage += '• <strong>💰 Einkommensteuer</strong> - wird direkt vom Einkommen erhoben<br>';
                feedbackMessage += '• <strong>🏢 Körperschaftsteuer</strong> - wird direkt von Unternehmen erhoben<br><br>';
                feedbackMessage += '<strong>Indirekte Steuern:</strong><br>';
                feedbackMessage += '• <strong>🛒 Mehrwertsteuer</strong> - wird über den Konsum erhoben<br>';
                feedbackMessage += '• <strong>⛽ Mineralölsteuer</strong> - wird über den Kraftstoffverbrauch erhoben';
            }
            
            showFeedback(4, isCorrect, feedbackMessage);
            
            if (isCorrect) {
                saveTaskResult(4, JSON.stringify(droppedTerms), true);
            }
        }

        function resetTask4() {
            // Zeige alle Begriffe wieder an
            document.querySelectorAll('.draggable-term').forEach(term => {
                term.style.display = 'flex';
                term.classList.remove('dropped', 'incorrect-drop');
                term.draggable = true;
                term.style.cursor = 'grab';
                term.title = '';
            });
            
            // Leere alle Drop-Zonen
            document.querySelectorAll('.dropped-items').forEach(container => {
                container.innerHTML = '';
            });
            
            // Reset der Datenstruktur
            droppedTerms = { direkt: [], indirekt: [] };
        }

        // Aufgabe 5: Slider
        function updateSliderValue(value) {
            document.getElementById('slider-value').textContent = value + '%';
        }

        function checkTask5() {
            const sliderValue = parseInt(document.getElementById('tax-slider').value);
            const isCorrect = sliderValue >= 25 && sliderValue <= 30;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = `✅ Richtig! Bei 45.000€ zu versteuerndem Einkommen liegt der Steuersatz bei etwa 25-30%. Sie haben ${sliderValue}% gewählt.`;
            } else {
                feedbackMessage = `❌ Nicht ganz richtig. Sie haben ${sliderValue}% gewählt.<br><br><strong>Vollständige Lösung:</strong><br>`;
                feedbackMessage += 'Bei einem zu versteuernden Einkommen von <strong>45.000 €</strong> liegt der Steuersatz bei etwa <strong>25-30%</strong>.<br><br>';
                feedbackMessage += '<strong>Erklärung:</strong><br>';
                feedbackMessage += '• Eingangssteuersatz: 14% (ab 10.908 €)<br>';
                feedbackMessage += '• Progressiver Anstieg bis zum Spitzensteuersatz<br>';
                feedbackMessage += '• Bei 45.000 €: ca. 25-30% Durchschnittssteuersatz<br>';
                feedbackMessage += '• Spitzensteuersatz: 42% (ab 62.810 €)';
            }
            
            showFeedback(5, isCorrect, feedbackMessage);
            saveTaskResult(5, sliderValue.toString(), isCorrect);
        }

        // Aufgabe 6: Wahr/Falsch
        let trueFalseAnswer = null;

        function selectTrueFalse(element, answer) {
            document.querySelectorAll('#task-6 .option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            element.classList.add('selected');
            trueFalseAnswer = answer;
        }

        function checkTask6() {
            if (trueFalseAnswer === null) {
                showFeedback(6, false, 'Bitte wählen Sie eine Antwort aus.');
                return;
            }
            
            const isCorrect = trueFalseAnswer === false;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '✅ Richtig! Die Aussage ist falsch. Die Kirchensteuer wird nicht nur von der Einkommensteuer erhoben.';
            } else {
                feedbackMessage = '❌ Falsch. Die Aussage ist nicht richtig.<br><br><strong>Vollständige Lösung:</strong><br>';
                feedbackMessage += 'Die Aussage "<em>Die Kirchensteuer wird nur von der Einkommensteuer erhoben</em>" ist <strong>FALSCH</strong>.<br><br>';
                feedbackMessage += '<strong>Erklärung:</strong><br>';
                feedbackMessage += 'Die Kirchensteuer wird erhoben von:<br>';
                feedbackMessage += '• <strong>Einkommensteuer</strong><br>';
                feedbackMessage += '• <strong>Lohnsteuer</strong><br>';
                feedbackMessage += '• <strong>Kapitalertragsteuer</strong><br>';
                feedbackMessage += '• <strong>Körperschaftsteuer</strong> (bei juristischen Personen)';
            }
            
            showFeedback(6, isCorrect, feedbackMessage);
            saveTaskResult(6, trueFalseAnswer.toString(), isCorrect);
        }

        // Aufgabe 7: Verbindungsaufgabe
        function initializeConnections() {
            const dots = document.querySelectorAll('.connection-dot');
            dots.forEach(dot => {
                dot.addEventListener('click', handleDotClick);
            });
        }

        function handleDotClick(e) {
            e.stopPropagation();
            const clickedDot = e.target;
            const clickedItem = clickedDot.closest('.connection-item');
            
            if (!selectedDot) {
                // Ersten Punkt auswählen
                selectedDot = clickedDot;
                clickedDot.classList.add('active');
                clickedItem.classList.add('selected');
                isConnecting = true;
            } else if (selectedDot === clickedDot) {
                // Gleichen Punkt erneut geklickt - Auswahl aufheben
                deselectDot();
            } else {
                // Zweiten Punkt auswählen - Verbindung erstellen
                const selectedItem = selectedDot.closest('.connection-item');
                const selectedSide = selectedDot.getAttribute('data-side');
                const clickedSide = clickedDot.getAttribute('data-side');
                
                // Nur Verbindungen zwischen verschiedenen Seiten erlauben
                if (selectedSide !== clickedSide) {
                    createConnection(selectedDot, clickedDot);
                }
                
                deselectDot();
            }
        }

        function deselectDot() {
            if (selectedDot) {
                selectedDot.classList.remove('active');
                selectedDot.closest('.connection-item').classList.remove('selected');
                selectedDot = null;
                isConnecting = false;
            }
        }

        function createConnection(dot1, dot2) {
            const item1 = dot1.closest('.connection-item');
            const item2 = dot2.closest('.connection-item');
            const id1 = item1.getAttribute('data-id');
            const id2 = item2.getAttribute('data-id');
            
            // Prüfen ob bereits eine Verbindung existiert
            const existingConnection = connections.find(conn => 
                (conn.from === id1 && conn.to === id2) || 
                (conn.from === id2 && conn.to === id1)
            );
            
            if (existingConnection) {
                return; // Verbindung bereits vorhanden
            }
            
            // Bestimme welcher Punkt links und welcher rechts ist
            let leftId, rightId, leftDot, rightDot;
            if (dot1.getAttribute('data-side') === 'right') {
                leftId = id1;
                rightId = id2;
                leftDot = dot1;
                rightDot = dot2;
            } else {
                leftId = id2;
                rightId = id1;
                leftDot = dot2;
                rightDot = dot1;
            }
            
            // Verbindung speichern
            connections.push({
                from: leftId,
                to: rightId,
                leftDot: leftDot,
                rightDot: rightDot
            });
            
            // Visuelle Markierung
            leftDot.classList.add('connected');
            rightDot.classList.add('connected');
            item1.classList.add('connected');
            item2.classList.add('connected');
            
            // Linie zeichnen
            drawConnection(leftDot, rightDot);
        }

        function drawConnection(leftDot, rightDot) {
            const svg = document.querySelector('.connection-container svg');
            if (!svg) {
                console.error('SVG element not found');
                return;
            }
            
            const connectionContainer = document.querySelector('.connection-container');
            
            // Warte kurz und berechne dann die Positionen
            setTimeout(() => {
                const containerRect = connectionContainer.getBoundingClientRect();
                const leftRect = leftDot.getBoundingClientRect();
                const rightRect = rightDot.getBoundingClientRect();
                
                // Relative Positionen zum connection-container berechnen
                const x1 = leftRect.left + leftRect.width/2 - containerRect.left;
                const y1 = leftRect.top + leftRect.height/2 - containerRect.top;
                const x2 = rightRect.left + rightRect.width/2 - containerRect.left;
                const y2 = rightRect.top + rightRect.height/2 - containerRect.top;
                
                // SVG ViewBox setzen
                svg.setAttribute('viewBox', `0 0 ${containerRect.width} ${containerRect.height}`);
                svg.setAttribute('width', containerRect.width);
                svg.setAttribute('height', containerRect.height);
                
                // Geschwungene Linie erstellen
                const midX = (x1 + x2) / 2;
                const curveOffset = 30;
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const d = `M ${x1} ${y1} Q ${midX} ${Math.min(y1, y2) - curveOffset} ${x2} ${y2}`;
                
                path.setAttribute('d', d);
                path.setAttribute('class', 'connection-line');
                path.setAttribute('data-connection', `${leftDot.closest('.connection-item').getAttribute('data-id')}-${rightDot.closest('.connection-item').getAttribute('data-id')}`);
                
                svg.appendChild(path);
            }, 50);
        }

        function resetConnections() {
            // Alle Verbindungen löschen
            connections = [];
            
            // SVG Linien entfernen
            const svg = document.querySelector('.connection-container svg');
            if (svg) {
                svg.innerHTML = '';
            }
            
            // Visuelle Markierungen entfernen
            document.querySelectorAll('.connection-dot').forEach(dot => {
                dot.classList.remove('connected', 'active');
            });
            
            document.querySelectorAll('.connection-item').forEach(item => {
                item.classList.remove('connected', 'selected');
            });
            
            // Auswahl zurücksetzen
            deselectDot();
            
            // Feedback ausblenden
            document.getElementById('feedback-7').style.display = 'none';
        }

        function checkTask7() {
            if (connections.length === 0) {
                showFeedback(7, false, 'Bitte erstellen Sie mindestens eine Verbindung.');
                return;
            }
            
            // Korrekte Zuordnungen definieren
            const correctConnections = {
                'umsatzsteuer': '19-prozent',
                'umsatzsteuer-ermaessigt': '7-prozent',
                'spitzensteuersatz': '42-prozent',
                'eingangssteuersatz': '14-prozent'
            };
            
            let correctCount = 0;
            let totalExpected = Object.keys(correctConnections).length;
            
            // Verbindungen prüfen und visuell markieren
            const svg = document.querySelector('.connection-container svg');
            if (svg) {
                const lines = svg.querySelectorAll('.connection-line');
                
                connections.forEach((conn, index) => {
                    const isCorrect = correctConnections[conn.from] === conn.to;
                    const line = lines[index];
                    
                    if (line) {
                        if (isCorrect) {
                            correctCount++;
                            line.classList.add('correct');
                        } else {
                            line.classList.add('incorrect');
                        }
                    }
                });
            }
            
            const isFullyCorrect = correctCount === totalExpected && connections.length === totalExpected;
            
            let feedbackMessage = '';
            if (isFullyCorrect) {
                feedbackMessage = '✅ Perfekt! Alle Verbindungen sind korrekt.';
            } else {
                feedbackMessage = `❌ ${correctCount} von ${totalExpected} Verbindungen sind korrekt.<br><br><strong>Vollständige Lösung:</strong><br>`;
                feedbackMessage += '• <strong>Umsatzsteuer (regulär)</strong> ↔ <strong>19%</strong><br>';
                feedbackMessage += '• <strong>Umsatzsteuer (ermäßigt)</strong> ↔ <strong>7%</strong><br>';
                feedbackMessage += '• <strong>Spitzensteuersatz</strong> ↔ <strong>42%</strong><br>';
                feedbackMessage += '• <strong>Eingangssteuersatz</strong> ↔ <strong>14%</strong>';
            }
            
            showFeedback(7, isFullyCorrect, feedbackMessage);
            saveTaskResult(7, JSON.stringify(connections), isFullyCorrect);
        }

        // Aufgabe 8: Speed-Quiz
        let speedQuizData = [];
        let currentSpeedQuestion = 0;
        let speedQuizScore = 0;
        let speedQuizTimer = null;
        let speedQuizTimeLeft = 3;
        let speedQuizStartTime = 0;
        let speedQuizAnswerTimes = [];
        let speedQuizCorrectAnswers = 0;

        const speedQuizQuestions = [
            {
                question: "Ist Kindergeld steuerpflichtig?",
                optionA: "Steuerpflichtig",
                optionB: "Nicht steuerpflichtig",
                correct: "b",
                explanation: "Kindergeld ist nicht steuerpflichtig"
            },
            {
                question: "Fahrtkosten zur Arbeit:",
                optionA: "Betrieblich",
                optionB: "Privat",
                correct: "a",
                explanation: "Fahrtkosten zur Arbeit sind betriebliche Ausgaben"
            },
            {
                question: "Ist eine Firmenweihnachtsfeier steuerpflichtig?",
                optionA: "Steuerpflichtig",
                optionB: "Nicht steuerpflichtig",
                correct: "b",
                explanation: "Firmenweihnachtsfeiern sind bis 110€ pro Person steuerfrei"
            },
            {
                question: "Ist ein Firmenwagen steuerpflichtig?",
                optionA: "Steuerpflichtig",
                optionB: "Nicht steuerpflichtig",
                correct: "a",
                explanation: "Firmenwagen für private Nutzung ist steuerpflichtig"
            },
            {
                question: "Fortbildungskosten:",
                optionA: "Betrieblich",
                optionB: "Privat",
                correct: "a",
                explanation: "Fortbildungskosten sind betriebliche Ausgaben"
            }
        ];

        function startSpeedQuiz() {
            document.getElementById('speed-quiz-start').style.display = 'none';
            document.getElementById('speed-quiz-active').style.display = 'block';
            
            currentSpeedQuestion = 0;
            speedQuizScore = 0;
            speedQuizCorrectAnswers = 0;
            speedQuizAnswerTimes = [];
            
            document.getElementById('total-questions').textContent = speedQuizQuestions.length;
            document.getElementById('quiz-score').textContent = speedQuizScore;
            
            showSpeedQuestion();
        }

        function showSpeedQuestion() {
            if (currentSpeedQuestion >= speedQuizQuestions.length) {
                showSpeedQuizResults();
                return;
            }
            
            const question = speedQuizQuestions[currentSpeedQuestion];
            
            document.getElementById('current-question').textContent = currentSpeedQuestion + 1;
            document.getElementById('speed-question').textContent = question.question;
            document.getElementById('option-a').textContent = question.optionA;
            document.getElementById('option-b').textContent = question.optionB;
            
            // Reset button states
            document.querySelectorAll('.speed-option').forEach(btn => {
                btn.classList.remove('correct', 'incorrect', 'disabled');
            });
            
            // Reset feedback
            const feedback = document.getElementById('speed-feedback');
            feedback.classList.remove('show', 'correct', 'incorrect');
            feedback.textContent = '';
            
            // Start timer
            speedQuizTimeLeft = 3;
            speedQuizStartTime = Date.now();
            startSpeedTimer();
        }

        function startSpeedTimer() {
            document.getElementById('timer-text').textContent = speedQuizTimeLeft;
            updateTimerCircle();
            
            speedQuizTimer = setInterval(() => {
                speedQuizTimeLeft--;
                document.getElementById('timer-text').textContent = speedQuizTimeLeft;
                updateTimerCircle();
                
                if (speedQuizTimeLeft <= 0) {
                    clearInterval(speedQuizTimer);
                    timeoutSpeedQuestion();
                }
            }, 1000);
        }

        function updateTimerCircle() {
            const percentage = (speedQuizTimeLeft / 3) * 100;
            const degrees = (percentage / 100) * 360;
            const circle = document.getElementById('timer-circle');
            
            if (percentage > 0) {
                circle.style.background = `conic-gradient(#ff3b30 ${degrees}deg, #e5e5e7 ${degrees}deg)`;
            } else {
                circle.style.background = '#e5e5e7';
            }
        }

        function answerSpeedQuestion(answer) {
            if (speedQuizTimer) {
                clearInterval(speedQuizTimer);
            }
            
            const responseTime = (Date.now() - speedQuizStartTime) / 1000;
            speedQuizAnswerTimes.push(responseTime);
            
            const question = speedQuizQuestions[currentSpeedQuestion];
            const isCorrect = answer === question.correct;
            
            // Disable all buttons
            document.querySelectorAll('.speed-option').forEach(btn => {
                btn.classList.add('disabled');
            });
            
            // Show visual feedback
            const selectedButton = document.getElementById(`option-${answer}`);
            const correctButton = document.getElementById(`option-${question.correct}`);
            
            if (isCorrect) {
                selectedButton.classList.add('correct');
                speedQuizScore += Math.max(1, Math.round(4 - responseTime)); // Bonus für schnelle Antworten
                speedQuizCorrectAnswers++;
                showSpeedFeedback(true, `✅ Richtig! +${Math.max(1, Math.round(4 - responseTime))} Punkte`);
            } else {
                selectedButton.classList.add('incorrect');
                correctButton.classList.add('correct');
                showSpeedFeedback(false, `❌ Falsch! ${question.explanation}`);
            }
            
            document.getElementById('quiz-score').textContent = speedQuizScore;
            
            // Next question after delay
            setTimeout(() => {
                currentSpeedQuestion++;
                showSpeedQuestion();
            }, 2000);
        }

        function timeoutSpeedQuestion() {
            const question = speedQuizQuestions[currentSpeedQuestion];
            speedQuizAnswerTimes.push(3); // Max time
            
            // Disable all buttons
            document.querySelectorAll('.speed-option').forEach(btn => {
                btn.classList.add('disabled');
            });
            
            // Show correct answer
            const correctButton = document.getElementById(`option-${question.correct}`);
            correctButton.classList.add('correct');
            
            showSpeedFeedback(false, `⏰ Zeit abgelaufen! ${question.explanation}`);
            
            // Next question after delay
            setTimeout(() => {
                currentSpeedQuestion++;
                showSpeedQuestion();
            }, 2000);
        }

        function showSpeedFeedback(isCorrect, message) {
            const feedback = document.getElementById('speed-feedback');
            feedback.textContent = message;
            feedback.classList.add('show', isCorrect ? 'correct' : 'incorrect');
        }

        function showSpeedQuizResults() {
            document.getElementById('speed-quiz-active').style.display = 'none';
            document.getElementById('speed-quiz-results').style.display = 'block';
            
            const averageTime = speedQuizAnswerTimes.reduce((a, b) => a + b, 0) / speedQuizAnswerTimes.length;
            const successRate = (speedQuizCorrectAnswers / speedQuizQuestions.length) * 100;
            
            document.getElementById('final-score').textContent = speedQuizScore;
            document.getElementById('correct-count').textContent = `${speedQuizCorrectAnswers}/${speedQuizQuestions.length}`;
            document.getElementById('average-time').textContent = averageTime.toFixed(1) + 's';
            
            // Results message and icon based on performance
            let resultsMessage = '';
            let resultsIcon = '';
            let resultsTitle = '';
            
            if (successRate >= 80) {
                resultsIcon = '🏆';
                resultsTitle = 'Hervorragend!';
                resultsMessage = 'Sie haben das Speed-Quiz mit Bravour gemeistert! Ihre Reaktionszeit und Ihr Steuerrechtswissen sind beeindruckend.';
            } else if (successRate >= 60) {
                resultsIcon = '🎯';
                resultsTitle = 'Gut gemacht!';
                resultsMessage = 'Solide Leistung! Sie haben die meisten Fragen richtig beantwortet und zeigen gutes Verständnis für Steuerrecht.';
            } else {
                resultsIcon = '📚';
                resultsTitle = 'Weiter üben!';
                resultsMessage = 'Das Speed-Quiz war eine gute Übung. Mit mehr Praxis werden Sie noch schneller und sicherer in Steuerfragen.';
            }
            
            document.getElementById('results-icon').textContent = resultsIcon;
            document.getElementById('results-title').textContent = resultsTitle;
            document.getElementById('results-message').textContent = resultsMessage;
            
            // Show completion feedback
            const isSuccess = successRate >= 60;
            showFeedback(8, isSuccess, `Speed-Quiz abgeschlossen! ${speedQuizCorrectAnswers} von ${speedQuizQuestions.length} Fragen richtig beantwortet.`);
            
            // Show next button
            document.getElementById('task-8-buttons').style.display = 'flex';
            
            // Save result
            saveTaskResult(8, JSON.stringify({
                score: speedQuizScore,
                correct: speedQuizCorrectAnswers,
                total: speedQuizQuestions.length,
                averageTime: averageTime
            }), isSuccess);
        }

        // Aufgabe 9: Steuer-Tetris
        let tetrisTerms = [];
        let currentTetrisTerm = 0;
        let tetrisScore = 0;
        let tetrisLives = 3;
        let tetrisCorrectAnswers = 0;
        let tetrisGameActive = false;
        let tetrisFallInterval = null;
        let tetrisCurrentPosition = 1; // 0=links, 1=mitte, 2=rechts
        let tetrisFallSpeed = 3000; // Millisekunden
        let tetrisKeyHandler = null;
        
        // Touch-Steuerung Variablen
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        let minSwipeDistance = 30;

        const tetrisGameTerms = [
            {
                term: "Büroausstattung",
                category: "betriebsausgabe",
                explanation: "Büroausstattung ist eine abziehbare Betriebsausgabe"
            },
            {
                term: "Privatreise",
                category: "nicht-abziehbar",
                explanation: "Privatreisen sind private Ausgaben und nicht absetzbar"
            },
            {
                term: "Geschäftsessen",
                category: "betriebsausgabe",
                explanation: "Geschäftsessen sind zu 70% als Betriebsausgabe absetzbar"
            },
            {
                term: "Geldstrafen",
                category: "nicht-abziehbar",
                explanation: "Geldstrafen sind nicht steuerlich absetzbar"
            },
            {
                term: "Fortbildung",
                category: "betriebsausgabe",
                explanation: "Fortbildungskosten sind abziehbare Betriebsausgaben"
            },
            {
                term: "Urlaubsreise",
                category: "nicht-abziehbar",
                explanation: "Urlaubsreisen sind private Ausgaben und nicht absetzbar"
            },
            {
                term: "Bestechungsgelder",
                category: "nicht-abziehbar",
                explanation: "Bestechungsgelder sind nicht steuerlich absetzbar"
            },
            {
                term: "Arbeitskleidung",
                category: "betriebsausgabe",
                explanation: "Arbeitskleidung ist eine abziehbare Betriebsausgabe"
            },
            {
                term: "Hobbykurse",
                category: "nicht-abziehbar",
                explanation: "Hobbykurse sind private Ausgaben und nicht absetzbar"
            },
            {
                term: "Bewirtungskosten",
                category: "betriebsausgabe",
                explanation: "Bewirtungskosten sind zu 70% als Betriebsausgabe absetzbar"
            }
        ];

        function startTetris() {
            document.getElementById('tetris-start').style.display = 'none';
            document.getElementById('tetris-game').style.display = 'block';
            
            currentTetrisTerm = 0;
            tetrisScore = 0;
            tetrisLives = 3;
            tetrisCorrectAnswers = 0;
            tetrisGameActive = true;
            tetrisCurrentPosition = 0;
            tetrisFallSpeed = 5500; // Leicht schnellere Geschwindigkeit: 5,5 Sekunden
            
            document.getElementById('total-terms').textContent = tetrisGameTerms.length;
            document.getElementById('tetris-score').textContent = tetrisScore;
            updateTetrisLives();
            
            // Entferne alte Event Listener falls vorhanden
            if (tetrisKeyHandler) {
                document.removeEventListener('keydown', tetrisKeyHandler);
            }
            
            // Keyboard event listener
            tetrisKeyHandler = handleTetrisKeyPress;
            document.addEventListener('keydown', tetrisKeyHandler);
            
            // Touch events für mobile Steuerung - auf das gesamte Spiel-Element anwenden
            const tetrisGame = document.getElementById('tetris-game');
            if (tetrisGame) {
                // Entferne alte Touch-Listener
                tetrisGame.removeEventListener('touchstart', handleTetrisTouchStart);
                tetrisGame.removeEventListener('touchmove', handleTetrisTouchMove);
                tetrisGame.removeEventListener('touchend', handleTetrisTouchEnd);
                
                // Füge neue Touch-Listener hinzu
                tetrisGame.addEventListener('touchstart', handleTetrisTouchStart, { passive: false });
                tetrisGame.addEventListener('touchmove', handleTetrisTouchMove, { passive: false });
                tetrisGame.addEventListener('touchend', handleTetrisTouchEnd, { passive: false });
                
                console.log('Touch events registered for Tetris'); // Debug
            }
            
            showNextTetrisTerm();
        }

        function showNextTetrisTerm() {
            if (currentTetrisTerm >= tetrisGameTerms.length || tetrisLives <= 0) {
                endTetrisGame();
                return;
            }
            
            const term = tetrisGameTerms[currentTetrisTerm];
            
            document.getElementById('current-term').textContent = currentTetrisTerm + 1;
            document.getElementById('term-content').textContent = term.term;
            
            // Reset position and zones
            tetrisCurrentPosition = 0;
            updateTetrisPosition();
            resetTetrisZones();
            
            // Start falling animation
            startTetrisFalling();
        }

        function startTetrisFalling() {
            const fallingTerm = document.getElementById('falling-term');
            
            // Komplett zurücksetzen der Animation
            fallingTerm.style.transition = 'none';
            fallingTerm.style.top = '-60px';
            
            // Force reflow um sicherzustellen dass der Reset angewendet wird
            fallingTerm.offsetHeight;
            
            // Transition wieder aktivieren - jetzt 6 Sekunden
            fallingTerm.style.transition = `top ${tetrisFallSpeed}ms linear`;
            
            // Start falling nach kurzer Verzögerung
            setTimeout(() => {
                fallingTerm.style.top = '280px'; // Just above the zones
            }, 50);
            
            // Auto-drop when reaching bottom - angepasst für leicht schnellere Geschwindigkeit
            tetrisFallInterval = setTimeout(() => {
                if (tetrisGameActive) {
                    dropTetrisTerm();
                }
            }, tetrisFallSpeed + 500); // 6 Sekunden total
        }

        function handleTetrisKeyPress(e) {
            if (!tetrisGameActive) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    if (tetrisCurrentPosition > 0) {
                        tetrisCurrentPosition--;
                        updateTetrisPosition();
                    }
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    if (tetrisCurrentPosition < 1) {
                        tetrisCurrentPosition++;
                        updateTetrisPosition();
                    }
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    dropTetrisTerm();
                    break;
            }
        }

        // Touch-Steuerung für mobile Geräte
        function handleTetrisTouchStart(e) {
            if (!tetrisGameActive) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            touchEndX = touchStartX; // Initialisiere auch touchEnd
            touchEndY = touchStartY;
        }

        function handleTetrisTouchMove(e) {
            if (!tetrisGameActive) return;
            e.preventDefault(); // Verhindert Scrollen
            
            // Aktualisiere kontinuierlich die End-Position während der Bewegung
            const touch = e.touches[0];
            touchEndX = touch.clientX;
            touchEndY = touch.clientY;
        }

        function handleTetrisTouchEnd(e) {
            if (!tetrisGameActive) return;
            
            e.preventDefault();
            
            // Falls touchEnd nicht durch touchMove gesetzt wurde, verwende changedTouches
            if (e.changedTouches && e.changedTouches.length > 0) {
                const touch = e.changedTouches[0];
                touchEndX = touch.clientX;
                touchEndY = touch.clientY;
            }
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            console.log('Touch Delta:', deltaX, deltaY, 'Min Distance:', minSwipeDistance); // Debug
            
            // Mindestdistanz für Wischbewegung
            if (Math.abs(deltaX) < minSwipeDistance && Math.abs(deltaY) < minSwipeDistance) {
                console.log('Swipe too short'); // Debug
                return;
            }
            
            // Bestimme Richtung der Wischbewegung
            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                // Horizontale Wischbewegung
                console.log('Horizontal swipe:', deltaX, 'Current pos:', tetrisCurrentPosition); // Debug
                if (deltaX > 0 && tetrisCurrentPosition < 1) {
                    // Wisch nach rechts
                    tetrisCurrentPosition++;
                    updateTetrisPosition();
                    showSwipeIndicator('→');
                    console.log('Moved right to position:', tetrisCurrentPosition); // Debug
                } else if (deltaX < 0 && tetrisCurrentPosition > 0) {
                    // Wisch nach links
                    tetrisCurrentPosition--;
                    updateTetrisPosition();
                    showSwipeIndicator('←');
                    console.log('Moved left to position:', tetrisCurrentPosition); // Debug
                }
            } else {
                // Vertikale Wischbewegung
                console.log('Vertical swipe:', deltaY); // Debug
                if (deltaY > 0) {
                    // Wisch nach unten - schneller fallen lassen
                    dropTetrisTerm();
                    showSwipeIndicator('↓');
                    console.log('Dropped term'); // Debug
                }
            }
        }

        function showSwipeIndicator(direction) {
            const gameArea = document.querySelector('.tetris-game-area');
            const indicator = document.createElement('div');
            indicator.textContent = direction;
            indicator.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 3rem;
                color: rgba(0, 122, 255, 0.8);
                z-index: 25;
                pointer-events: none;
                animation: swipeIndicatorPop 0.6s ease-out;
                text-shadow: 0 2px 8px rgba(0,0,0,0.3);
            `;
            
            gameArea.appendChild(indicator);
            
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.remove();
                }
            }, 600);
        }

        function updateTetrisPosition() {
            const fallingTerm = document.getElementById('falling-term');
            const positions = ['25%', '75%']; // Links, Rechts
            fallingTerm.style.left = positions[tetrisCurrentPosition];
            
            // Update zone highlighting
            resetTetrisZones();
            const zones = document.querySelectorAll('.tetris-zone');
            zones[tetrisCurrentPosition].classList.add('active');
        }

        function resetTetrisZones() {
            document.querySelectorAll('.tetris-zone').forEach(zone => {
                zone.classList.remove('active', 'correct', 'incorrect');
            });
        }

        function dropTetrisTerm() {
            if (!tetrisGameActive) return;
            
            clearTimeout(tetrisFallInterval);
            
            const currentTerm = tetrisGameTerms[currentTetrisTerm];
            const zones = document.querySelectorAll('.tetris-zone');
            const selectedZone = zones[tetrisCurrentPosition];
            const selectedCategory = selectedZone.getAttribute('data-category');
            
            const isCorrect = selectedCategory === currentTerm.category;
            
            // Visual feedback
            if (isCorrect) {
                selectedZone.classList.add('correct');
                tetrisScore += 10;
                tetrisCorrectAnswers++;
                showTetrisFeedback(true, `✅ Richtig! +10 Punkte`);
            } else {
                selectedZone.classList.add('incorrect');
                tetrisLives--;
                showTetrisFeedback(false, `❌ Falsch! ${currentTerm.explanation}`);
            }
            
            document.getElementById('tetris-score').textContent = tetrisScore;
            updateTetrisLives();
            
            // Next term after delay
            setTimeout(() => {
                currentTetrisTerm++;
                if (tetrisLives > 0) {
                    showNextTetrisTerm();
                } else {
                    endTetrisGame();
                }
            }, 2000);
        }

        function showTetrisFeedback(isCorrect, message) {
            // Create temporary feedback element
            const gameArea = document.querySelector('.tetris-game-area');
            const feedback = document.createElement('div');
            feedback.className = `tetris-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${isCorrect ? 'rgba(48, 209, 88, 0.95)' : 'rgba(255, 59, 48, 0.95)'};
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                font-weight: 600;
                font-size: 1.1rem;
                z-index: 20;
                animation: feedbackPop 0.5s ease-out;
                text-align: center;
                max-width: 80%;
                box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            `;
            feedback.textContent = message;
            
            gameArea.appendChild(feedback);
            
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
            }, 1800);
        }

        function updateTetrisLives() {
            const hearts = '❤️'.repeat(tetrisLives) + '🖤'.repeat(3 - tetrisLives);
            document.getElementById('tetris-lives').textContent = hearts;
        }

        function endTetrisGame() {
            tetrisGameActive = false;
            
            if (tetrisKeyHandler) {
                document.removeEventListener('keydown', tetrisKeyHandler);
                tetrisKeyHandler = null;
            }
            
            // Touch event listeners entfernen
            const tetrisGame = document.getElementById('tetris-game');
            if (tetrisGame) {
                tetrisGame.removeEventListener('touchstart', handleTetrisTouchStart);
                tetrisGame.removeEventListener('touchmove', handleTetrisTouchMove);
                tetrisGame.removeEventListener('touchend', handleTetrisTouchEnd);
            }
            
            clearTimeout(tetrisFallInterval);
            
            document.getElementById('tetris-game').style.display = 'none';
            document.getElementById('tetris-results').style.display = 'block';
            
            const accuracy = Math.round((tetrisCorrectAnswers / tetrisGameTerms.length) * 100);
            
            document.getElementById('tetris-final-score').textContent = tetrisScore;
            document.getElementById('tetris-correct-count').textContent = `${tetrisCorrectAnswers}/${tetrisGameTerms.length}`;
            document.getElementById('tetris-accuracy').textContent = accuracy + '%';
            
            // Results message and icon based on performance
            let resultsMessage = '';
            let resultsIcon = '';
            let resultsTitle = '';
            
            if (accuracy >= 80) {
                resultsIcon = '🏆';
                resultsTitle = 'Steuer-Meister!';
                resultsMessage = 'Hervorragend! Sie haben die Steuerbegriffe perfekt zugeordnet und zeigen ausgezeichnetes Verständnis für steuerliche Kategorien.';
            } else if (accuracy >= 60) {
                resultsIcon = '🎯';
                resultsTitle = 'Gut gespielt!';
                resultsMessage = 'Solide Leistung! Sie haben die meisten Begriffe richtig zugeordnet und zeigen gutes Verständnis für Steuerrecht.';
            } else {
                resultsIcon = '📚';
                resultsTitle = 'Weiter üben!';
                resultsMessage = 'Das Steuer-Tetris war eine gute Übung. Mit mehr Praxis werden Sie noch sicherer bei der Zuordnung von Steuerbegriffen.';
            }
            
            document.getElementById('tetris-results-icon').textContent = resultsIcon;
            document.getElementById('tetris-results-title').textContent = resultsTitle;
            document.getElementById('tetris-results-message').textContent = resultsMessage;
            
            // Show completion feedback
            const isSuccess = accuracy >= 60;
            showFeedback(9, isSuccess, `Steuer-Tetris abgeschlossen! ${tetrisCorrectAnswers} von ${tetrisGameTerms.length} Begriffen richtig zugeordnet.`);
            
            // Show next button
            document.getElementById('task-9-buttons').style.display = 'flex';
            
            // Save result
            saveTaskResult(9, JSON.stringify({
                score: tetrisScore,
                correct: tetrisCorrectAnswers,
                total: tetrisGameTerms.length,
                accuracy: accuracy,
                lives: tetrisLives
            }), isSuccess);
        }

        // Aufgabe 10: Wer bin ich? Rätsel
        let riddleCurrentHint = 0;
        let riddleMaxHints = 3;
        let riddleGameActive = false;
        let riddlePointsEarned = 0;

        // Aufgabe 11: Begründung bauen
        let reasoningSlots = { 1: null, 2: null, 3: null };
        let reasoningDraggedBlock = null;

        function startRiddle() {
            document.getElementById('riddle-start').style.display = 'none';
            document.getElementById('riddle-game').style.display = 'block';
            
            riddleCurrentHint = 0;
            riddleGameActive = true;
            riddlePointsEarned = 0;
            
            document.getElementById('current-hint').textContent = '1';
            document.getElementById('total-hints').textContent = riddleMaxHints;
            document.getElementById('possible-points').textContent = riddleMaxHints;
            document.getElementById('riddle-answer').value = '';
            
            // Alle Hinweise verstecken
            for (let i = 1; i <= riddleMaxHints; i++) {
                document.getElementById(`hint-${i}`).style.display = 'none';
            }
            
            // Ersten Hinweis zeigen
            showNextHint();
        }

        function showNextHint() {
            if (riddleCurrentHint >= riddleMaxHints) {
                return;
            }
            
            riddleCurrentHint++;
            
            // Hinweis mit Animation anzeigen
            const hintElement = document.getElementById(`hint-${riddleCurrentHint}`);
            hintElement.style.display = 'block';
            
            // UI aktualisieren
            document.getElementById('current-hint').textContent = riddleCurrentHint;
            document.getElementById('possible-points').textContent = riddleMaxHints - riddleCurrentHint + 1;
            
            // Button-Status aktualisieren
            const hintBtn = document.getElementById('hint-btn');
            if (riddleCurrentHint >= riddleMaxHints) {
                hintBtn.style.display = 'none';
            } else {
                hintBtn.textContent = `Hinweis ${riddleCurrentHint + 1} anzeigen`;
            }
        }

        function checkRiddleAnswer() {
            if (!riddleGameActive) return;
            
            const userAnswer = document.getElementById('riddle-answer').value.trim().toLowerCase();
            const correctAnswers = ['rückstellung', 'rueckstellung', 'rückstellungen', 'rueckstellungen'];
            
            const isCorrect = correctAnswers.some(answer => userAnswer.includes(answer));
            
            if (isCorrect) {
                riddlePointsEarned = riddleMaxHints - riddleCurrentHint + 1;
                showRiddleResults(true);
            } else if (userAnswer.length < 2) {
                // Zu kurze Antwort
                const riddleInput = document.getElementById('riddle-answer');
                riddleInput.style.borderColor = '#ff3b30';
                riddleInput.placeholder = 'Bitte geben Sie eine Antwort ein...';
                
                setTimeout(() => {
                    riddleInput.style.borderColor = '#e5e5e7';
                    riddleInput.placeholder = 'Ihre Antwort eingeben...';
                }, 2000);
            } else {
                // Falsche Antwort
                if (riddleCurrentHint >= riddleMaxHints) {
                    // Alle Hinweise verwendet, Spiel beenden
                    riddlePointsEarned = 0;
                    showRiddleResults(false);
                } else {
                    // Nächsten Hinweis anbieten
                    const riddleInput = document.getElementById('riddle-answer');
                    riddleInput.style.borderColor = '#ff9500';
                    riddleInput.value = '';
                    riddleInput.placeholder = 'Versuchen Sie es mit dem nächsten Hinweis...';
                    
                    setTimeout(() => {
                        riddleInput.style.borderColor = '#e5e5e7';
                        riddleInput.placeholder = 'Ihre Antwort eingeben...';
                        showNextHint();
                    }, 1500);
                }
            }
        }

        function showRiddleResults(wasCorrect) {
            riddleGameActive = false;
            
            document.getElementById('riddle-game').style.display = 'none';
            document.getElementById('riddle-results').style.display = 'block';
            
            // Statistiken aktualisieren
            document.getElementById('riddle-final-points').textContent = riddlePointsEarned;
            document.getElementById('riddle-hints-used').textContent = riddleCurrentHint;
            
            // Ergebnis-Icon und Titel
            let resultsIcon = '';
            let resultsTitle = '';
            let performanceMessage = '';
            
            if (wasCorrect) {
                if (riddlePointsEarned === 3) {
                    resultsIcon = '🏆';
                    resultsTitle = 'Brilliant!';
                    performanceMessage = 'Hervorragend! Sie haben den Begriff sofort nach dem ersten Hinweis erkannt. Das zeigt ausgezeichnetes Verständnis für Steuerfachbegriffe.';
                } else if (riddlePointsEarned === 2) {
                    resultsIcon = '🎯';
                    resultsTitle = 'Sehr gut!';
                    performanceMessage = 'Gut gemacht! Sie haben den Begriff nach zwei Hinweisen erkannt. Das zeigt solides Wissen im Steuerrecht.';
                } else {
                    resultsIcon = '✅';
                    resultsTitle = 'Geschafft!';
                    performanceMessage = 'Sie haben den Begriff nach allen Hinweisen erkannt. Mit mehr Übung werden Sie noch schneller bei Steuerfachbegriffen.';
                }
            } else {
                resultsIcon = '📚';
                resultsTitle = 'Nicht erkannt';
                performanceMessage = 'Das war ein schwieriger Begriff! Rückstellungen sind ein komplexes Thema im Steuerrecht. Die Erklärung hilft Ihnen beim nächsten Mal.';
            }
            
            document.getElementById('riddle-results-icon').textContent = resultsIcon;
            document.getElementById('riddle-results-title').textContent = resultsTitle;
            document.getElementById('riddle-performance').textContent = performanceMessage;
            
            // Feedback und Weiter-Button
            const feedbackMessage = wasCorrect ? 
                `✅ Rätsel gelöst! Sie haben ${riddlePointsEarned} von 3 möglichen Punkten erhalten.` :
                '📚 Rätsel nicht gelöst, aber Sie haben etwas Neues gelernt!';
            
            showFeedback(10, wasCorrect, feedbackMessage);
            document.getElementById('task-10-buttons').style.display = 'flex';
            
            // Ergebnis speichern
            saveTaskResult(10, JSON.stringify({
                answer: document.getElementById('riddle-answer').value,
                hintsUsed: riddleCurrentHint,
                pointsEarned: riddlePointsEarned,
                wasCorrect: wasCorrect
            }), wasCorrect);
        }



        // Aufgabe 11: Begründung bauen - Funktionen
        function initializeReasoning() {
            const blocks = document.querySelectorAll('.reasoning-block');
            const slots = document.querySelectorAll('.reasoning-slot');
            
            // Drag Events für Bausteine - nur Desktop
            blocks.forEach(block => {
                block.addEventListener('dragstart', handleReasoningDragStart);
                block.addEventListener('dragend', handleReasoningDragEnd);
            });
            
            // Drop Events für Slots
            slots.forEach(slot => {
                slot.addEventListener('dragover', handleReasoningDragOver);
                slot.addEventListener('dragenter', handleReasoningDragEnter);
                slot.addEventListener('dragleave', handleReasoningDragLeave);
                slot.addEventListener('drop', handleReasoningDrop);
            });
        }

        // Aufgabe 12: Paragraphen-Schießen
        let shootingGameActive = false;
        let shootingCurrentStatement = 0;
        let shootingScore = 0;
        let shootingLives = 3;
        let shootingCorrectAnswers = 0;
        let shootingFlyingParagraphs = [];
        let shootingSpawnInterval = null;
        let shootingStatementAnswered = false;
        let shootingTimeoutId = null;

        const shootingStatements = [
            {
                statement: "Welcher Paragraf regelt die Umsatzsteuerbefreiung für Heilbehandlungen?",
                correctParagraph: "§ 4 Nr. 14 UStG",
                decoyParagraphs: ["§ 3 Nr. 12 UStG", "§ 5 Nr. 8 UStG", "§ 6 Nr. 15 UStG"]
            },
            {
                statement: "Welcher Paragraf regelt die Kleinunternehmerregelung?",
                correctParagraph: "§ 19 UStG",
                decoyParagraphs: ["§ 15 UStG", "§ 23 UStG", "§ 12 UStG"]
            },
            {
                statement: "Welcher Paragraf regelt die Vorsteuerabzugsberechtigung?",
                correctParagraph: "§ 15 UStG",
                decoyParagraphs: ["§ 19 UStG", "§ 11 UStG", "§ 7 UStG"]
            },
            {
                statement: "Welcher Paragraf regelt die Steuerschuldnerschaft des Leistungsempfängers?",
                correctParagraph: "§ 13b UStG",
                decoyParagraphs: ["§ 13a UStG", "§ 14 UStG", "§ 12 UStG"]
            },
            {
                statement: "Welcher Paragraf regelt die Rechnungsstellung?",
                correctParagraph: "§ 14 UStG",
                decoyParagraphs: ["§ 13 UStG", "§ 15 UStG", "§ 16 UStG"]
            }
        ];

        function startShooting() {
            document.getElementById('shooting-start').style.display = 'none';
            document.getElementById('shooting-game').style.display = 'block';
            
            shootingGameActive = true;
            shootingCurrentStatement = 0;
            shootingScore = 0;
            shootingLives = 3;
            shootingCorrectAnswers = 0;
            shootingFlyingParagraphs = [];
            
            document.getElementById('total-statements').textContent = shootingStatements.length;
            document.getElementById('shooting-score').textContent = shootingScore;
            updateShootingLives();
            
            showNextStatement();
        }

        function showNextStatement() {
            if (shootingCurrentStatement >= shootingStatements.length || shootingLives <= 0) {
                endShootingGame();
                return;
            }
            
            const statement = shootingStatements[shootingCurrentStatement];
            
            document.getElementById('current-statement').textContent = shootingCurrentStatement + 1;
            document.getElementById('statement-text').textContent = statement.statement;
            
            // Reset für neue Aussage
            shootingStatementAnswered = false;
            clearFlyingParagraphs();
            
            // Kurze Pause vor dem Start der Paragraphen
            setTimeout(() => {
                if (shootingGameActive) {
                    startSpawningParagraphs();
                }
            }, 1000);
        }

        function startSpawningParagraphs() {
            if (!shootingGameActive || shootingStatementAnswered) return;
            
            const statement = shootingStatements[shootingCurrentStatement];
            const allParagraphs = [statement.correctParagraph, ...statement.decoyParagraphs];
            
            // Mische die Paragraphen
            const shuffledParagraphs = [...allParagraphs].sort(() => Math.random() - 0.5);
            
            let spawnIndex = 0;
            
            // Spawne Paragraphen in Intervallen
            shootingSpawnInterval = setInterval(() => {
                if (spawnIndex < shuffledParagraphs.length && shootingGameActive && !shootingStatementAnswered) {
                    spawnFlyingParagraph(shuffledParagraphs[spawnIndex]);
                    spawnIndex++;
                } else {
                    clearInterval(shootingSpawnInterval);
                    shootingSpawnInterval = null;
                }
            }, 800); // Alle 800ms einen neuen Paragraphen
            
            // Timeout für die gesamte Aussage (10 Sekunden)
            shootingTimeoutId = setTimeout(() => {
                if (shootingGameActive && !shootingStatementAnswered) {
                    // Zeit abgelaufen - Leben abziehen
                    shootingLives--;
                    updateShootingLives();
                    showShootingFeedback(false, `⏰ Zeit abgelaufen! Richtig wäre: ${statement.correctParagraph}`);
                    
                    shootingStatementAnswered = true;
                    clearFlyingParagraphs();
                    
                    setTimeout(() => {
                        if (shootingLives > 0) {
                            shootingCurrentStatement++;
                            showNextStatement();
                        } else {
                            endShootingGame();
                        }
                    }, 2500);
                }
            }, 10000);
        }

        function spawnFlyingParagraph(paragraphText) {
            if (!shootingGameActive || shootingStatementAnswered) return;
            
            const gameArea = document.getElementById('shooting-game-area');
            const paragraph = document.createElement('div');
            paragraph.className = 'flying-paragraph';
            paragraph.textContent = paragraphText;
            
            // Zufällige Startposition (verschiedene Höhen)
            const gameAreaHeight = gameArea.offsetHeight || 350;
            const startY = Math.random() * (gameAreaHeight - 120) + 40; // Mehr Abstand zu den Rändern
            
            paragraph.style.cssText = `
                position: absolute;
                left: -250px;
                top: ${startY}px;
                cursor: pointer;
                z-index: 15;
                transition: left 8000ms linear;
                pointer-events: auto;
            `;
            
            // Click Handler
            paragraph.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                handleParagraphClick(paragraph, paragraphText);
            });
            
            gameArea.appendChild(paragraph);
            
            // Speichere Paragraphen-Info
            const paragraphInfo = {
                element: paragraph,
                text: paragraphText,
                clicked: false
            };
            shootingFlyingParagraphs.push(paragraphInfo);
            
            // Starte Flug-Animation nach kurzer Verzögerung
            setTimeout(() => {
                if (paragraph.parentNode && shootingGameActive) {
                    const gameAreaWidth = gameArea.offsetWidth || 800;
                    paragraph.style.left = (gameAreaWidth + 100) + 'px';
                }
            }, 100);
            
            // Entferne Paragraphen nach Flugzeit automatisch - angepasst für leicht schnellere Geschwindigkeit
            setTimeout(() => {
                if (paragraph.parentNode && !paragraphInfo.clicked) {
                    paragraph.classList.add('missed');
                    setTimeout(() => {
                        if (paragraph.parentNode) {
                            paragraph.remove();
                        }
                    }, 300);
                    
                    // Entferne aus Array
                    const index = shootingFlyingParagraphs.indexOf(paragraphInfo);
                    if (index > -1) {
                        shootingFlyingParagraphs.splice(index, 1);
                    }
                }
            }, 8000); // 8 Sekunden für leicht schnellere Paragraphen
        }

        function handleParagraphClick(paragraphElement, paragraphText) {
            if (!shootingGameActive || shootingStatementAnswered) return;
            
            const statement = shootingStatements[shootingCurrentStatement];
            const isCorrect = paragraphText === statement.correctParagraph;
            
            // Markiere als geklickt
            const paragraphInfo = shootingFlyingParagraphs.find(p => p.element === paragraphElement);
            if (paragraphInfo) {
                paragraphInfo.clicked = true;
            }
            
            // Stoppe Animation
            paragraphElement.style.transition = 'none';
            paragraphElement.style.pointerEvents = 'none';
            
            if (isCorrect) {
                // Richtige Antwort
                paragraphElement.classList.add('correct-hit');
                shootingScore += 10;
                shootingCorrectAnswers++;
                showShootingFeedback(true, `✅ Richtig! +10 Punkte`);
                
                shootingStatementAnswered = true;
                clearFlyingParagraphs();
                
                // Nächste Aussage nach kurzer Pause
                setTimeout(() => {
                    shootingCurrentStatement++;
                    showNextStatement();
                }, 1500);
                
            } else {
                // Falsche Antwort
                paragraphElement.classList.add('incorrect-hit');
                shootingLives--;
                updateShootingLives();
                showShootingFeedback(false, `❌ Falsch! Richtig wäre: ${statement.correctParagraph}`);
                
                // Bei falscher Antwort: Aussage als beantwortet markieren und weitermachen
                shootingStatementAnswered = true;
                clearFlyingParagraphs();
                
                setTimeout(() => {
                    if (shootingLives > 0) {
                        shootingCurrentStatement++;
                        showNextStatement();
                    } else {
                        endShootingGame();
                    }
                }, 2500);
            }
            
            document.getElementById('shooting-score').textContent = shootingScore;
            
            // Entferne geklickten Paragraphen nach Animation
            setTimeout(() => {
                if (paragraphElement.parentNode) {
                    paragraphElement.remove();
                }
            }, 600);
        }

        function clearFlyingParagraphs() {
            // Stoppe alle Intervals und Timeouts
            if (shootingSpawnInterval) {
                clearInterval(shootingSpawnInterval);
                shootingSpawnInterval = null;
            }
            if (shootingTimeoutId) {
                clearTimeout(shootingTimeoutId);
                shootingTimeoutId = null;
            }
            
            // Entferne alle Paragraphen aus dem DOM
            const gameArea = document.getElementById('shooting-game-area');
            if (gameArea) {
                const paragraphs = gameArea.querySelectorAll('.flying-paragraph');
                paragraphs.forEach(p => p.remove());
            }
            
            // Reset Array
            shootingFlyingParagraphs = [];
        }

        function showShootingFeedback(isCorrect, message) {
            const gameArea = document.querySelector('.shooting-game-area');
            const feedback = document.createElement('div');
            feedback.className = `shooting-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.cssText = `
                position: absolute;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${isCorrect ? 'rgba(48, 209, 88, 0.95)' : 'rgba(255, 59, 48, 0.95)'};
                color: white;
                padding: 12px 20px;
                border-radius: 25px;
                font-weight: 600;
                font-size: 1rem;
                z-index: 30;
                animation: feedbackPop 0.5s ease-out;
                text-align: center;
                max-width: 80%;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                pointer-events: none;
            `;
            feedback.textContent = message;
            
            gameArea.appendChild(feedback);
            
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.remove();
                }
            }, 2000);
        }

        function updateShootingLives() {
            const hearts = '❤️'.repeat(shootingLives) + '🖤'.repeat(3 - shootingLives);
            document.getElementById('shooting-lives').textContent = hearts;
        }

        function endShootingGame() {
            shootingGameActive = false;
            clearFlyingParagraphs();
            
            document.getElementById('shooting-game').style.display = 'none';
            document.getElementById('shooting-results').style.display = 'block';
            
            const accuracy = shootingStatements.length > 0 ? Math.round((shootingCorrectAnswers / shootingStatements.length) * 100) : 0;
            
            document.getElementById('shooting-final-score').textContent = shootingScore;
            document.getElementById('shooting-correct-count').textContent = `${shootingCorrectAnswers}/${shootingStatements.length}`;
            document.getElementById('shooting-accuracy').textContent = accuracy + '%';
            
            // Results message and icon based on performance
            let resultsMessage = '';
            let resultsIcon = '';
            let resultsTitle = '';
            
            if (accuracy >= 80) {
                resultsIcon = '🏆';
                resultsTitle = 'Scharfschütze!';
                resultsMessage = 'Hervorragend! Sie haben die Paragraphen mit Präzision getroffen und zeigen ausgezeichnetes Wissen im Steuerrecht.';
            } else if (accuracy >= 60) {
                resultsIcon = '🎯';
                resultsTitle = 'Guter Schütze!';
                resultsMessage = 'Solide Leistung! Sie haben die meisten Paragraphen richtig erkannt und zeigen gutes Verständnis für Steuerrecht.';
            } else {
                resultsIcon = '📚';
                resultsTitle = 'Weiter üben!';
                resultsMessage = 'Das Paragraphen-Schießen war eine gute Übung. Mit mehr Praxis werden Sie noch treffsicherer bei Steuerparagraphen.';
            }
            
            document.getElementById('shooting-results-icon').textContent = resultsIcon;
            document.getElementById('shooting-results-title').textContent = resultsTitle;
            document.getElementById('shooting-results-message').textContent = resultsMessage;
            
            // Show completion feedback
            const isSuccess = accuracy >= 60;
            showFeedback(12, isSuccess, `Paragraphen-Schießen abgeschlossen! ${shootingCorrectAnswers} von ${shootingStatements.length} Paragraphen richtig getroffen.`);
            
            // Save result
            saveTaskResult(12, JSON.stringify({
                score: shootingScore,
                correct: shootingCorrectAnswers,
                total: shootingStatements.length,
                accuracy: accuracy,
                lives: shootingLives
            }), isSuccess);
        }

        // Aufgabe 13: Das Schloss öffnen (Escape Game)
        let solvedPuzzles = 0;
        let puzzleAnswers = {};
        let trueFalseAnswer4 = null;
        let miniSortableDraggedElement = null;

        function initializeEscapeGame() {
            // Mini-Sortierung initialisieren
            const miniItems = document.querySelectorAll('.mini-item');
            miniItems.forEach(item => {
                item.draggable = true;
                item.addEventListener('dragstart', handleMiniDragStart);
                item.addEventListener('dragend', handleMiniDragEnd);
            });
            
            const miniContainer = document.getElementById('mini-sortable');
            miniContainer.addEventListener('dragover', handleMiniDragOver);
            miniContainer.addEventListener('drop', handleMiniDrop);
        }

        function handleMiniDragStart(e) {
            miniSortableDraggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleMiniDragEnd(e) {
            this.classList.remove('dragging');
            miniSortableDraggedElement = null;
        }

        function handleMiniDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            if (!miniSortableDraggedElement) return;
            
            const afterElement = getMiniDragAfterElement(this, e.clientY);
            
            if (afterElement == null) {
                this.appendChild(miniSortableDraggedElement);
            } else {
                this.insertBefore(miniSortableDraggedElement, afterElement);
            }
        }

        function handleMiniDrop(e) {
            e.preventDefault();
        }

        function getMiniDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.mini-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Rätsel 1: §-Kombination
        function checkPuzzle1() {
            const paragraphNumber = parseInt(document.getElementById('paragraph-number').value);
            const paragraphSubnumber = parseInt(document.getElementById('paragraph-subnumber').value);
            
            const isCorrect = paragraphNumber === 4 && paragraphSubnumber === 14;
            
            if (isCorrect) {
                solvePuzzle(1, '§ 4 Nr. 14 UStG');
                showPuzzleFeedback(1, true, '✅ Richtig! § 4 Nr. 14 UStG regelt die Umsatzsteuerbefreiung für Heilbehandlungen.');
            } else {
                showPuzzleFeedback(1, false, '❌ Falsch. Tipp: Es ist § 4 Nr. 14 UStG.');
            }
        }

        // Rätsel 2: Zahlencode
        function checkPuzzle2() {
            const numberCode = parseInt(document.getElementById('number-code').value);
            
            const isCorrect = numberCode === 26; // 19% + 7% = 26%
            
            if (isCorrect) {
                solvePuzzle(2, '26%');
                showPuzzleFeedback(2, true, '✅ Richtig! 19% + 7% = 26%');
            } else {
                showPuzzleFeedback(2, false, '❌ Falsch. Rechnen Sie: 19% + 7% = ?');
            }
        }

        // Rätsel 3: Sortierung
        function checkPuzzle3() {
            const miniContainer = document.getElementById('mini-sortable');
            const items = miniContainer.querySelectorAll('.mini-item');
            const currentOrder = Array.from(items).map(item => parseInt(item.getAttribute('data-value')));
            const correctOrder = [7, 14, 19, 42]; // Ermäßigte USt, Eingangssteuersatz, Umsatzsteuer, Spitzensteuersatz
            
            const isCorrect = JSON.stringify(currentOrder) === JSON.stringify(correctOrder);
            
            if (isCorrect) {
                solvePuzzle(3, 'Korrekte Reihenfolge');
                showPuzzleFeedback(3, true, '✅ Richtig! Die Steuersätze sind korrekt sortiert: 7%, 14%, 19%, 42%');
            } else {
                showPuzzleFeedback(3, false, '❌ Falsch. Sortieren Sie von niedrigstem zu höchstem Steuersatz.');
            }
        }

        // Rätsel 4: Wahr/Falsch
        function selectTrueFalse4(element, answer) {
            document.querySelectorAll('#puzzle-4 .tf-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            element.classList.add('selected');
            trueFalseAnswer4 = answer;
        }

        function checkPuzzle4() {
            if (trueFalseAnswer4 === null) {
                showPuzzleFeedback(4, false, 'Bitte wählen Sie eine Antwort aus.');
                return;
            }
            
            const isCorrect = trueFalseAnswer4 === false; // Die Aussage ist falsch - Kleinunternehmerregelung gilt BIS 22.000€
            
            if (isCorrect) {
                solvePuzzle(4, 'Falsch');
                showPuzzleFeedback(4, true, '✅ Richtig! Die Aussage ist falsch. Die Kleinunternehmerregelung gilt BIS 22.000€ Jahresumsatz.');
            } else {
                showPuzzleFeedback(4, false, '❌ Falsch. Die Kleinunternehmerregelung gilt BIS 22.000€, nicht AB 22.000€.');
            }
        }

        // Rätsel 5: Mini-Rechnung
        function checkPuzzle5() {
            const calculationResult = parseFloat(document.getElementById('calculation-result').value);
            
            const isCorrect = Math.abs(calculationResult - 119) < 0.01; // 100€ + 19% = 119€
            
            if (isCorrect) {
                solvePuzzle(5, '119€');
                showPuzzleFeedback(5, true, '✅ Richtig! 100€ + 19% Umsatzsteuer = 119€');
            } else {
                showPuzzleFeedback(5, false, '❌ Falsch. Rechnen Sie: 100€ + (100€ × 19%) = ?');
            }
        }

        function solvePuzzle(puzzleNumber, answer) {
            if (puzzleAnswers[puzzleNumber]) return; // Bereits gelöst
            
            puzzleAnswers[puzzleNumber] = answer;
            solvedPuzzles++;
            
            // Visuelles Feedback
            const puzzleCard = document.getElementById(`puzzle-${puzzleNumber}`);
            const puzzleStatus = document.getElementById(`status-${puzzleNumber}`);
            const puzzleBtn = puzzleCard.querySelector('.puzzle-btn');
            
            puzzleCard.classList.add('solved');
            puzzleStatus.textContent = '✅';
            puzzleStatus.classList.add('solved');
            puzzleBtn.disabled = true;
            puzzleBtn.textContent = 'Gelöst';
            
            // Fortschritt aktualisieren
            document.getElementById('solved-puzzles').textContent = solvedPuzzles;
            
            // Prüfen ob alle Rätsel gelöst sind
            if (solvedPuzzles >= 5) {
                unlockEscapeGame();
            }
        }

        function showPuzzleFeedback(puzzleNumber, isCorrect, message) {
            // Temporäres Feedback in der Puzzle-Karte anzeigen
            const puzzleCard = document.getElementById(`puzzle-${puzzleNumber}`);
            
            // Entferne vorheriges Feedback
            const existingFeedback = puzzleCard.querySelector('.puzzle-feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }
            
            // Neues Feedback erstellen
            const feedback = document.createElement('div');
            feedback.className = `puzzle-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.cssText = `
                margin-top: 10px;
                padding: 10px 15px;
                border-radius: 8px;
                font-size: 0.9rem;
                font-weight: 500;
                background: ${isCorrect ? 'rgba(48, 209, 88, 0.1)' : 'rgba(255, 59, 48, 0.1)'};
                border: 1px solid ${isCorrect ? '#30d158' : '#ff3b30'};
                color: ${isCorrect ? '#1d4ed8' : '#dc2626'};
                animation: feedbackSlideIn 0.3s ease-out;
            `;
            feedback.textContent = message;
            
            puzzleCard.appendChild(feedback);
            
            // Feedback nach 3 Sekunden entfernen (außer bei korrekten Antworten)
            if (!isCorrect) {
                setTimeout(() => {
                    if (feedback.parentNode) {
                        feedback.remove();
                    }
                }, 3000);
            }
        }

        function unlockEscapeGame() {
            // Schloss öffnen Animation
            const lockIcon = document.getElementById('lock-icon');
            const lockStatus = document.getElementById('lock-status');
            
            lockIcon.textContent = '🔓';
            lockIcon.classList.add('unlocked');
            lockStatus.textContent = 'Schloss geöffnet!';
            lockStatus.classList.add('unlocked');
            
            // Erfolgs-Animation anzeigen
            setTimeout(() => {
                document.getElementById('success-animation').style.display = 'block';
                document.getElementById('task-13-buttons').style.display = 'flex';
                
                // Hauptfeedback anzeigen
                showFeedback(13, true, '🎉 Herzlichen Glückwunsch! Sie haben alle Rätsel gelöst und das Schloss geöffnet!');
                
                // Ergebnis speichern
                saveTaskResult(13, JSON.stringify({
                    solvedPuzzles: solvedPuzzles,
                    puzzleAnswers: puzzleAnswers,
                    totalPuzzles: 5
                }), true);
            }, 1000);
        }

        function resetEscapeGame() {
            solvedPuzzles = 0;
            puzzleAnswers = {};
            trueFalseAnswer4 = null;
            
            // UI zurücksetzen
            document.getElementById('solved-puzzles').textContent = '0';
            document.getElementById('lock-icon').textContent = '🔒';
            document.getElementById('lock-icon').classList.remove('unlocked');
            document.getElementById('lock-status').textContent = 'Schloss verschlossen';
            document.getElementById('lock-status').classList.remove('unlocked');
            
            // Puzzle-Karten zurücksetzen
            for (let i = 1; i <= 5; i++) {
                const puzzleCard = document.getElementById(`puzzle-${i}`);
                const puzzleStatus = document.getElementById(`status-${i}`);
                const puzzleBtn = puzzleCard.querySelector('.puzzle-btn');
                
                puzzleCard.classList.remove('solved');
                puzzleStatus.textContent = '🔒';
                puzzleStatus.classList.remove('solved');
                puzzleBtn.disabled = false;
                puzzleBtn.textContent = 'Prüfen';
                
                // Feedback entfernen
                const feedback = puzzleCard.querySelector('.puzzle-feedback');
                if (feedback) {
                    feedback.remove();
                }
            }
            
            // Eingabefelder zurücksetzen
            document.getElementById('paragraph-number').value = '';
            document.getElementById('paragraph-subnumber').value = '';
            document.getElementById('number-code').value = '';
            document.getElementById('calculation-result').value = '';
            
            // Wahr/Falsch Buttons zurücksetzen
            document.querySelectorAll('#puzzle-4 .tf-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Erfolgs-Animation verstecken
            document.getElementById('success-animation').style.display = 'none';
            document.getElementById('task-13-buttons').style.display = 'none';
            document.getElementById('feedback-13').style.display = 'none';
        }

        function handleReasoningDragStart(e) {
            reasoningDraggedBlock = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleReasoningDragEnd(e) {
            this.classList.remove('dragging');
            reasoningDraggedBlock = null;
        }

        function handleReasoningDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleReasoningDragEnter(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleReasoningDragLeave(e) {
            if (!this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        }

        function handleReasoningDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (!reasoningDraggedBlock) return;
            
            const slotPosition = parseInt(this.getAttribute('data-position'));
            const slotContent = this.querySelector('.slot-content');
            const blockText = reasoningDraggedBlock.querySelector('.block-text').textContent;
            const blockIcon = reasoningDraggedBlock.querySelector('.block-icon').textContent;
            
            // Prüfen ob Slot bereits belegt ist
            if (reasoningSlots[slotPosition]) {
                // Alten Block wieder verfügbar machen
                const oldBlockId = reasoningSlots[slotPosition].blockId;
                const oldBlock = document.getElementById(oldBlockId);
                if (oldBlock) {
                    oldBlock.classList.remove('used');
                }
            }
            
            // Neuen Block in Slot platzieren
            reasoningSlots[slotPosition] = {
                blockId: reasoningDraggedBlock.id,
                text: blockText,
                icon: blockIcon
            };
            
            // Slot visuell aktualisieren
            slotContent.innerHTML = `<span style="margin-right: 8px;">${blockIcon}</span>${blockText}`;
            slotContent.classList.add('filled');
            this.classList.add('filled');
            
            // Block als verwendet markieren
            reasoningDraggedBlock.classList.add('used');
            
            // Preview aktualisieren
            updateReasoningPreview();
        }

        // Touch Events für Begründung bauen entfernt - nur Desktop-Unterstützung

        function updateReasoningPreview() {
            const preview = document.getElementById('reasoning-preview');
            const previewText = document.getElementById('preview-text');
            
            // Prüfen ob alle Slots gefüllt sind
            const filledSlots = Object.values(reasoningSlots).filter(slot => slot !== null);
            
            if (filledSlots.length > 0) {
                let fullText = '';
                for (let i = 1; i <= 3; i++) {
                    if (reasoningSlots[i]) {
                        fullText += reasoningSlots[i].text + ' ';
                    }
                }
                
                previewText.textContent = fullText.trim();
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function resetReasoning() {
            // Slots zurücksetzen
            reasoningSlots = { 1: null, 2: null, 3: null };
            
            // Slot-Inhalte zurücksetzen
            for (let i = 1; i <= 3; i++) {
                const slot = document.querySelector(`[data-position="${i}"]`);
                const slotContent = slot.querySelector('.slot-content');
                slotContent.textContent = 'Baustein hier ablegen...';
                slotContent.classList.remove('filled');
                slot.classList.remove('filled');
            }
            
            // Alle Blöcke wieder verfügbar machen
            document.querySelectorAll('.reasoning-block').forEach(block => {
                block.classList.remove('used');
            });
            
            // Preview verstecken
            document.getElementById('reasoning-preview').style.display = 'none';
            
            // Feedback verstecken
            document.getElementById('feedback-11').style.display = 'none';
        }

        function checkTask11() {
            // Prüfen ob alle Slots gefüllt sind
            const filledSlots = Object.values(reasoningSlots).filter(slot => slot !== null);
            
            if (filledSlots.length < 3) {
                showFeedback(11, false, 'Bitte füllen Sie alle drei Positionen mit Bausteinen aus.');
                return;
            }
            
            // Korrekte Reihenfolge prüfen
            const correctOrder = {
                1: 'block-3', // "Nach § 4 Nr. 14 UStG"
                2: 'block-1', // "ist dieser Umsatz steuerfrei, weil es sich um eine"
                3: 'block-2'  // "Heilbehandlung im Bereich der Humanmedizin handelt."
            };
            
            let correctCount = 0;
            let isFullyCorrect = true;
            
            for (let position = 1; position <= 3; position++) {
                if (reasoningSlots[position] && reasoningSlots[position].blockId === correctOrder[position]) {
                    correctCount++;
                } else {
                    isFullyCorrect = false;
                }
            }
            
            let feedbackMessage = '';
            if (isFullyCorrect) {
                feedbackMessage = '✅ Perfekt! Sie haben eine korrekte rechtliche Begründung aufgebaut.<br><br>';
                feedbackMessage += '<strong>📝 Ihre vollständige Begründung:</strong><br>';
                feedbackMessage += '"Nach § 4 Nr. 14 UStG ist dieser Umsatz steuerfrei, weil es sich um eine Heilbehandlung im Bereich der Humanmedizin handelt."<br><br>';
                feedbackMessage += '<strong>💡 Erklärung:</strong> Diese Begründung folgt dem klassischen Aufbau: Rechtsgrundlage → Rechtsfolge → Tatbestandsmerkmale.';
            } else {
                feedbackMessage = `❌ ${correctCount} von 3 Bausteinen sind an der richtigen Position.<br><br><strong>Vollständige Lösung:</strong><br>`;
                feedbackMessage += '<strong>1.</strong> "Nach § 4 Nr. 14 UStG" (Rechtsgrundlage)<br>';
                feedbackMessage += '<strong>2.</strong> "ist dieser Umsatz steuerfrei, weil es sich um eine" (Rechtsfolge)<br>';
                feedbackMessage += '<strong>3.</strong> "Heilbehandlung im Bereich der Humanmedizin handelt." (Tatbestandsmerkmale)<br><br>';
                feedbackMessage += '<strong>💡 Tipp:</strong> Eine rechtliche Begründung beginnt immer mit der Rechtsgrundlage (Paragraf), dann folgt die Rechtsfolge und schließlich die konkreten Tatbestandsmerkmale.';
            }
            
            showFeedback(11, isFullyCorrect, feedbackMessage);
            saveTaskResult(11, JSON.stringify(reasoningSlots), isFullyCorrect);
        }



        // Hilfsfunktionen
        function showFeedback(taskNumber, isCorrect, message) {
            const feedback = document.getElementById(`feedback-${taskNumber}`);
            feedback.innerHTML = message;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.display = 'block';
            
            if (isCorrect && !userAnswers[taskNumber]) {
                completedTasks++;
                correctAnswers++;
                updateProgress();
            }
            
            totalAttempts++;
            taskAttempts[taskNumber] = (taskAttempts[taskNumber] || 0) + 1;
            
            // Button zu "Zurücksetzen" ändern (außer bei Spielen)
            const currentTaskCard = document.getElementById(`task-${taskNumber}`);
            const checkButton = currentTaskCard.querySelector('.btn-primary');
            const gameTasksWithoutReset = [8, 9, 10, 12, 13]; // Speed-Quiz, Tetris, Rätsel, Schießen, Escape
            
            if (!gameTasksWithoutReset.includes(taskNumber)) {
                checkButton.textContent = 'Zurücksetzen';
                checkButton.onclick = () => resetTask(taskNumber);
            }
            
            setTimeout(() => {
                updateNavigationButtons();
            }, 100);
        }

        function resetTask(taskNumber) {
            // Feedback ausblenden
            const feedback = document.getElementById(`feedback-${taskNumber}`);
            feedback.style.display = 'none';
            
            // Button zurück zu "Antwort prüfen" ändern
            const currentTaskCard = document.getElementById(`task-${taskNumber}`);
            const checkButton = currentTaskCard.querySelector('.btn-primary');
            
            // Aufgabenspezifische Zurücksetzung
            switch(taskNumber) {
                case 1:
                    // Lückentext zurücksetzen
                    document.getElementById('gap-1').textContent = '';
                    document.getElementById('gap-2').textContent = '';
                    document.getElementById('gap-3').textContent = '';
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask1;
                    break;
                    
                case 2:
                    // Multiple Choice zurücksetzen
                    document.querySelectorAll('#task-2 .option-button').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    selectedOptions = [];
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask2;
                    break;
                    
                case 3:
                    // Sortierung zurücksetzen - Originalreihenfolge wiederherstellen
                    const container = document.getElementById('sortable-container');
                    const items = [
                        { text: 'Steuerklasse I (ledig)', order: '3' },
                        { text: 'Steuerklasse III (verheiratet, Alleinverdiener)', order: '1' },
                        { text: 'Steuerklasse IV (verheiratet, beide berufstätig)', order: '4' },
                        { text: 'Steuerklasse V (verheiratet, Zweitverdiener)', order: '2' }
                    ];
                    container.innerHTML = '';
                    items.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'sortable-item';
                        div.setAttribute('data-order', item.order);
                        div.textContent = item.text;
                        container.appendChild(div);
                    });
                    initializeSortable();
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask3;
                    break;
                    
                case 4:
                    // Zuordnung zurücksetzen
                    resetTask4();
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask4;
                    break;
                    
                case 5:
                    // Slider zurücksetzen
                    document.getElementById('tax-slider').value = 20;
                    updateSliderValue(20);
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask5;
                    break;
                    
                case 6:
                    // Wahr/Falsch zurücksetzen
                    document.querySelectorAll('#task-6 .option-button').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    trueFalseAnswer = null;
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask6;
                    break;
                    
                case 7:
                    // Verbindungen zurücksetzen
                    resetConnections();
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask7;
                    break;
                    
                case 11:
                    // Begründung bauen zurücksetzen
                    resetReasoning();
                    checkButton.textContent = 'Antwort prüfen';
                    checkButton.onclick = checkTask11;
                    break;
            }
        }

        async function saveTaskResult(taskId, userAnswer, isCorrect) {
            userAnswers[taskId] = { answer: userAnswer, correct: isCorrect };
            
            if (window.dataSdk) {
                const result = await window.dataSdk.create({
                    task_id: `task_${taskId}`,
                    task_type: getTaskType(taskId),
                    user_answer: userAnswer,
                    is_correct: isCorrect,
                    completed_at: new Date().toISOString(),
                    attempts: taskAttempts[taskId] || 1
                });
                
                if (!result.isOk) {
                    console.error("Failed to save task result");
                }
            }
        }

        function getTaskType(taskId) {
            const types = {
                1: 'Lückentext',
                2: 'Multiple Choice',
                3: 'Sortierung',
                4: 'Zuordnung',
                5: 'Berechnung',
                6: 'Wahr/Falsch',
                7: 'Verbindung',
                8: 'Speed-Quiz',
                9: 'Steuer-Tetris',
                10: 'Wer bin ich?',
                11: 'Begründung bauen',
                12: 'Paragraphen-Schießen',
                13: 'Das Schloss öffnen'
            };
            return types[taskId] || 'Unbekannt';
        }

        function showCompletionScreen() {
            for (let i = 1; i <= totalTasks; i++) {
                document.getElementById(`task-${i}`).classList.remove('active');
            }
            
            document.getElementById('navigation-buttons').style.display = 'none';
            
            document.getElementById('correct-answers').textContent = correctAnswers;
            document.getElementById('total-attempts').textContent = totalAttempts;
            document.getElementById('success-rate').textContent = Math.round((correctAnswers / totalTasks) * 100) + '%';
            
            document.getElementById('completion-screen').classList.add('active');
        }

        function updateStatsFromData(data) {
            const uniqueTasks = new Set(data.map(item => item.task_id));
            const correctTasks = data.filter(item => item.is_correct);
            
            if (uniqueTasks.size > 0) {
                document.getElementById('correct-answers').textContent = correctTasks.length;
                document.getElementById('total-attempts').textContent = data.length;
                document.getElementById('success-rate').textContent = Math.round((correctTasks.length / uniqueTasks.size) * 100) + '%';
            }
        }

        function restartQuiz() {
            currentTask = 1;
            completedTasks = 0;
            userAnswers = {};
            taskAttempts = {};
            correctAnswers = 0;
            totalAttempts = 0;
            selectedOptions = [];
            trueFalseAnswer = null;
            selectedMatchingItem = null;
            matches = {};
            
            updateProgress();
            document.getElementById('completion-screen').classList.remove('active');
            document.getElementById('navigation-buttons').style.display = 'flex';
            
            for (let i = 1; i <= totalTasks; i++) {
                document.getElementById(`feedback-${i}`).style.display = 'none';
            }
            
            resetTaskButtons();
            
            document.getElementById('gap-1').textContent = '';
            document.getElementById('gap-2').textContent = '';
            document.getElementById('gap-3').textContent = '';
            document.getElementById('tax-slider').value = 20;
            updateSliderValue(20);
            
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            resetTask4();
            resetConnections();
            resetReasoning();
            
            // Sortierung zurücksetzen
            const container = document.getElementById('sortable-container');
            const items = [
                { text: 'Steuerklasse I (ledig)', order: '3' },
                { text: 'Steuerklasse III (verheiratet, Alleinverdiener)', order: '1' },
                { text: 'Steuerklasse IV (verheiratet, beide berufstätig)', order: '4' },
                { text: 'Steuerklasse V (verheiratet, Zweitverdiener)', order: '2' }
            ];
            container.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'sortable-item';
                div.setAttribute('data-order', item.order);
                div.textContent = item.text;
                container.appendChild(div);
            });
            initializeSortable();
            
            showTask(1);
        }

        function resetTaskButtons() {
            const taskButtons = [
                { id: 'task-1', text: 'Antwort prüfen', func: checkTask1 },
                { id: 'task-2', text: 'Antwort prüfen', func: checkTask2 },
                { id: 'task-3', text: 'Antwort prüfen', func: checkTask3 },
                { id: 'task-4', text: 'Antwort prüfen', func: checkTask4 },
                { id: 'task-5', text: 'Antwort prüfen', func: checkTask5 },
                { id: 'task-6', text: 'Antwort prüfen', func: checkTask6 },
                { id: 'task-7', text: 'Antwort prüfen', func: checkTask7 },
                { id: 'task-11', text: 'Antwort prüfen', func: checkTask11 }
            ];
            
            taskButtons.forEach(task => {
                const taskCard = document.getElementById(task.id);
                const button = taskCard.querySelector('.btn-primary');
                if (button) {
                    button.textContent = task.text;
                    button.onclick = task.func;
                }
            });
            
            // Reset Speed-Quiz
            document.getElementById('speed-quiz-start').style.display = 'block';
            document.getElementById('speed-quiz-active').style.display = 'none';
            document.getElementById('speed-quiz-results').style.display = 'none';
            document.getElementById('task-8-buttons').style.display = 'none';
            
            // Reset Steuer-Tetris
            document.getElementById('tetris-start').style.display = 'block';
            document.getElementById('tetris-game').style.display = 'none';
            document.getElementById('tetris-results').style.display = 'none';
            document.getElementById('task-9-buttons').style.display = 'none';
            
            // Reset Wer bin ich? Rätsel
            document.getElementById('riddle-start').style.display = 'block';
            document.getElementById('riddle-game').style.display = 'none';
            document.getElementById('riddle-results').style.display = 'none';
            document.getElementById('task-10-buttons').style.display = 'none';
            document.getElementById('riddle-answer').value = '';
            riddleGameActive = false;
            riddleCurrentHint = 0;
            
            // Reset Begründung bauen
            resetReasoning();
            
            // Reset Paragraphen-Schießen
            document.getElementById('shooting-start').style.display = 'block';
            document.getElementById('shooting-game').style.display = 'none';
            document.getElementById('shooting-results').style.display = 'none';
            document.getElementById('task-12-buttons').style.display = 'none';
            shootingGameActive = false;
            clearFlyingParagraphs();
            
            // Reset Escape Game
            resetEscapeGame();
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99f77b8a11149240',t:'MTc2MzMwMTI5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
