<!doctype html>
<html lang="de">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steuerrecht Lernkontrolle</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #1d1d1f;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            font-size: 1.1rem;
            color: #6e6e73;
            margin: 0;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e5e7;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #30d158, #32d74b);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #6e6e73;
            text-align: center;
        }

        .task-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .task-card.active {
            display: block;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .task-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .task-type {
            color: #6e6e73;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .task-question {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            font-size: 1rem;
            background: #f5f5f7;
            transition: all 0.2s ease;
            margin-bottom: 15px;
        }

        .input-field:focus {
            outline: none;
            border-color: #007aff;
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        .gap-text {
            display: inline-block;
            min-width: 120px;
            padding: 8px 12px;
            border: 2px dashed #007aff;
            border-radius: 8px;
            background: rgba(0, 122, 255, 0.05);
            margin: 0 4px;
            text-align: center;
            font-weight: 500;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .option-button {
            padding: 16px 20px;
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            background: #f5f5f7;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            text-align: center;
            font-weight: 500;
        }

        .option-button:hover {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.05);
        }

        .option-button.selected {
            border-color: #007aff;
            background: #007aff;
            color: white;
        }

        .sortable-list {
            min-height: 200px;
            border: 2px dashed #e5e5e7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .sortable-item {
            background: white;
            border: 1px solid #e5e5e7;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .sortable-item:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .sortable-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }

        .matching-column {
            background: #f5f5f7;
            border-radius: 12px;
            padding: 20px;
        }

        .matching-item {
            background: white;
            border: 2px solid #e5e5e7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-weight: 500;
        }

        .matching-item:hover {
            border-color: #007aff;
            transform: translateY(-2px);
        }

        .matching-item.selected {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.1);
        }

        .matching-item.matched {
            border-color: #30d158;
            background: rgba(48, 209, 88, 0.1);
            cursor: default;
        }

        .slider-container {
            margin: 25px 0;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e5e7;
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 15px;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #007aff;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        .slider-value {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #007aff;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #007aff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056cc;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3);
        }

        .btn-secondary {
            background: #f5f5f7;
            color: #1d1d1f;
            border: 2px solid #e5e5e7;
        }

        .btn-secondary:hover {
            background: #e5e5e7;
        }

        .feedback {
            margin-top: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 500;
            display: none;
        }

        .feedback.correct {
            background: rgba(48, 209, 88, 0.1);
            border: 2px solid #30d158;
            color: #1d4ed8;
        }

        .feedback.incorrect {
            background: rgba(255, 59, 48, 0.1);
            border: 2px solid #ff3b30;
            color: #dc2626;
        }

        .completion-screen {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .completion-screen.active {
            display: block;
        }

        .completion-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .completion-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #30d158;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #007aff;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6e6e73;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .matching-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- Aufgabe 1: L√ºckentext -->
   <div class="task-card active" id="task-1">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 1
     </div>
     <div class="task-type">
      L√ºckentext
     </div>
    </div>
    <div class="task-question">
     Vervollst√§ndigen Sie den folgenden Satz √ºber die Umsatzsteuer:
    </div>
    <p style="font-size: 1.1rem; line-height: 1.6;">Die Umsatzsteuer betr√§gt in Deutschland regul√§r <span class="gap-text" id="gap-1" contenteditable="true" placeholder="___%"></span> und erm√§√üigt <span class="gap-text" id="gap-2" contenteditable="true" placeholder="___%"></span>. Unternehmen mit einem Jahresumsatz unter <span class="gap-text" id="gap-3" contenteditable="true" placeholder="_____ ‚Ç¨"></span> k√∂nnen die Kleinunternehmerregelung nutzen.</p>
    <div class="feedback" id="feedback-1"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask1()">Antwort pr√ºfen</button>
    </div>
   </div><!-- Aufgabe 2: Multiple Choice -->
   <div class="task-card" id="task-2">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 2
     </div>
     <div class="task-type">
      Multiple Choice
     </div>
    </div>
    <div class="task-question">
     Welche Ausgaben k√∂nnen als Werbungskosten geltend gemacht werden?
    </div>
    <div class="options-grid">
     <div class="option-button" onclick="selectOption(this, 'a')">
      Fahrtkosten zur Arbeit
     </div>
     <div class="option-button" onclick="selectOption(this, 'b')">
      Fortbildungskosten
     </div>
     <div class="option-button" onclick="selectOption(this, 'c')">
      Arbeitskleidung
     </div>
     <div class="option-button" onclick="selectOption(this, 'd')">
      Alle genannten
     </div>
    </div>
    <div class="feedback" id="feedback-2"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask2()">Antwort pr√ºfen</button>
    </div>
   </div><!-- Aufgabe 3: Drag & Drop Sortierung -->
   <div class="task-card" id="task-3">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 3
     </div>
     <div class="task-type">
      Sortierung
     </div>
    </div>
    <div class="task-question">
     Sortieren Sie die Steuerklassen nach der H√∂he der Steuerbelastung (niedrigste zuerst):
    </div>
    <div class="sortable-list" id="sortable-list">
     <div class="sortable-item" draggable="true" data-order="3">
      Steuerklasse I (ledig)
     </div>
     <div class="sortable-item" draggable="true" data-order="1">
      Steuerklasse III (verheiratet, Alleinverdiener)
     </div>
     <div class="sortable-item" draggable="true" data-order="4">
      Steuerklasse IV (verheiratet, beide berufst√§tig)
     </div>
     <div class="sortable-item" draggable="true" data-order="2">
      Steuerklasse V (verheiratet, Zweitverdiener)
     </div>
    </div>
    <div class="feedback" id="feedback-3"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask3()">Reihenfolge pr√ºfen</button>
    </div>
   </div><!-- Aufgabe 4: Zuordnung -->
   <div class="task-card" id="task-4">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 4
     </div>
     <div class="task-type">
      Zuordnung
     </div>
    </div>
    <div class="task-question">
     Ordnen Sie die Steuerarten den entsprechenden Kategorien zu:
    </div>
    <div class="matching-container">
     <div class="matching-column">
      <h4 style="text-align: center; margin-bottom: 15px;">Steuerarten</h4>
      <div class="matching-item" data-match="direkt" onclick="selectMatching(this)">
       Einkommensteuer
      </div>
      <div class="matching-item" data-match="indirekt" onclick="selectMatching(this)">
       Mehrwertsteuer
      </div>
      <div class="matching-item" data-match="direkt" onclick="selectMatching(this)">
       K√∂rperschaftsteuer
      </div>
      <div class="matching-item" data-match="indirekt" onclick="selectMatching(this)">
       Mineral√∂lsteuer
      </div>
     </div>
     <div class="matching-column">
      <h4 style="text-align: center; margin-bottom: 15px;">Kategorien</h4>
      <div class="matching-item" data-category="direkt" onclick="selectCategory(this)">
       Direkte Steuern
      </div>
      <div class="matching-item" data-category="indirekt" onclick="selectCategory(this)">
       Indirekte Steuern
      </div>
     </div>
    </div>
    <div class="feedback" id="feedback-4"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask4()">Zuordnung pr√ºfen</button>
    </div>
   </div><!-- Aufgabe 5: Slider/Berechnung -->
   <div class="task-card" id="task-5">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 5
     </div>
     <div class="task-type">
      Berechnung
     </div>
    </div>
    <div class="task-question">
     Stellen Sie den Steuersatz f√ºr ein zu versteuerndes Einkommen von 45.000 ‚Ç¨ ein:
    </div>
    <div class="slider-container"><input type="range" min="0" max="45" value="20" class="slider" id="tax-slider" oninput="updateSliderValue(this.value)">
     <div class="slider-value" id="slider-value">
      20%
     </div>
    </div>
    <p style="text-align: center; color: #6e6e73; margin-top: 15px;">Hinweis: Der Eingangssteuersatz betr√§gt 14%, der Spitzensteuersatz 42%</p>
    <div class="feedback" id="feedback-5"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask5()">Steuersatz pr√ºfen</button>
    </div>
   </div><!-- Aufgabe 6: Wahr/Falsch -->
   <div class="task-card" id="task-6">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 6
     </div>
     <div class="task-type">
      Wahr/Falsch
     </div>
    </div>
    <div class="task-question">
     Bewerten Sie folgende Aussage: "Die Kirchensteuer wird nur von der Einkommensteuer erhoben."
    </div>
    <div class="options-grid">
     <div class="option-button" onclick="selectTrueFalse(this, true)">
      ‚úì Wahr
     </div>
     <div class="option-button" onclick="selectTrueFalse(this, false)">
      ‚úó Falsch
     </div>
    </div>
    <div class="feedback" id="feedback-6"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask6()">Antwort pr√ºfen</button>
    </div>
   </div><!-- Aufgabe 7: Freitext -->
   <div class="task-card" id="task-7">
    <div class="task-header">
     <div class="task-number">
      Aufgabe 7
     </div>
     <div class="task-type">
      Freitext
     </div>
    </div>
    <div class="task-question">
     Erkl√§ren Sie in 2-3 S√§tzen den Unterschied zwischen Brutto- und Nettoeinkommen:
    </div><textarea class="input-field" id="freetext-answer" rows="4" placeholder="Ihre Antwort hier eingeben..."></textarea>
    <div class="feedback" id="feedback-7"></div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="checkTask7()">Antwort einreichen</button>
    </div>
   </div><!-- Abschlussbildschirm -->
   <div class="completion-screen" id="completion-screen">
    <div class="completion-icon">
     üéâ
    </div>
    <div class="completion-title">
     Herzlichen Gl√ºckwunsch!
    </div>
    <p id="completion-message">Herzlichen Gl√ºckwunsch! Sie haben alle Aufgaben erfolgreich bearbeitet.</p>
    <div class="stats-grid">
     <div class="stat-card">
      <div class="stat-number" id="correct-answers">
       0
      </div>
      <div class="stat-label">
       Richtige Antworten
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="total-attempts">
       0
      </div>
      <div class="stat-label">
       Gesamtversuche
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="success-rate">
       0%
      </div>
      <div class="stat-label">
       Erfolgsquote
      </div>
     </div>
    </div>
    <div class="action-buttons"><button class="btn btn-primary" onclick="restartQuiz()">Erneut starten</button>
    </div>
   </div>
   <div class="action-buttons" id="navigation-buttons"><button class="btn btn-secondary" onclick="previousTask()" id="prev-btn" style="display: none;">Zur√ºck</button> <button class="btn btn-primary" onclick="nextTask()" id="next-btn" style="display: none;">Weiter</button>
   </div>
  </div>
  <script>
        let currentTask = 1;
        const totalTasks = 7;
        let completedTasks = 0;
        let userAnswers = {};
        let taskAttempts = {};
        let correctAnswers = 0;
        let totalAttempts = 0;

        // Konfiguration
        const defaultConfig = {
            platform_title: "Steuerrecht Lernkontrolle",
            welcome_text: "Willkommen zur interaktiven Lernkontrolle",
            completion_message: "Herzlichen Gl√ºckwunsch! Sie haben alle Aufgaben erfolgreich bearbeitet."
        };

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                // Statistiken aus gespeicherten Daten aktualisieren
                if (data.length > 0) {
                    updateStatsFromData(data);
                }
            }
        };

        // Element SDK Initialisierung
        async function initializeSDKs() {
            if (window.dataSdk) {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Data SDK initialization failed");
                }
            }

            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        document.getElementById('platform-title').textContent = config.platform_title || defaultConfig.platform_title;
                        document.getElementById('welcome-text').textContent = config.welcome_text || defaultConfig.welcome_text;
                        document.getElementById('completion-message').textContent = config.completion_message || defaultConfig.completion_message;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["platform_title", config.platform_title || defaultConfig.platform_title],
                        ["welcome_text", config.welcome_text || defaultConfig.welcome_text],
                        ["completion_message", config.completion_message || defaultConfig.completion_message]
                    ])
                });
            }
        }

        // Initialisierung beim Laden der Seite
        document.addEventListener('DOMContentLoaded', function() {
            initializeSDKs();
            updateProgress();
            setupDragAndDrop();
        });

        function updateProgress() {
            const progress = (completedTasks / totalTasks) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Aufgabe ${completedTasks} von ${totalTasks}`;
        }

        function showTask(taskNumber) {
            // Alle Aufgaben ausblenden
            for (let i = 1; i <= totalTasks; i++) {
                document.getElementById(`task-${i}`).classList.remove('active');
            }
            
            // Gew√ºnschte Aufgabe anzeigen
            document.getElementById(`task-${taskNumber}`).classList.add('active');
            currentTask = taskNumber;
            
            // Navigation buttons aktualisieren
            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.style.display = currentTask > 1 ? 'block' : 'none';
            nextBtn.style.display = (currentTask < totalTasks && userAnswers[currentTask]) ? 'block' : 'none';
        }

        function nextTask() {
            if (currentTask < totalTasks) {
                showTask(currentTask + 1);
            } else if (completedTasks === totalTasks) {
                showCompletionScreen();
            }
        }

        function previousTask() {
            if (currentTask > 1) {
                showTask(currentTask - 1);
            }
        }

        // Aufgabe 1: L√ºckentext
        function checkTask1() {
            const gap1 = document.getElementById('gap-1').textContent.trim();
            const gap2 = document.getElementById('gap-2').textContent.trim();
            const gap3 = document.getElementById('gap-3').textContent.trim();
            
            const correct1 = gap1 === '19' || gap1 === '19%';
            const correct2 = gap2 === '7' || gap2 === '7%';
            const correct3 = gap3 === '22000' || gap3 === '22.000' || gap3 === '22000‚Ç¨' || gap3 === '22.000‚Ç¨';
            
            const isCorrect = correct1 && correct2 && correct3;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '‚úÖ Richtig! Die Umsatzsteuer betr√§gt 19% (regul√§r) und 7% (erm√§√üigt). Die Kleinunternehmerregelung gilt bis 22.000‚Ç¨.';
            } else {
                feedbackMessage = '‚ùå Nicht ganz richtig.<br><br><strong>Vollst√§ndige L√∂sung:</strong><br>';
                feedbackMessage += 'Die Umsatzsteuer betr√§gt in Deutschland regul√§r <strong>19%</strong> und erm√§√üigt <strong>7%</strong>. ';
                feedbackMessage += 'Unternehmen mit einem Jahresumsatz unter <strong>22.000 ‚Ç¨</strong> k√∂nnen die Kleinunternehmerregelung nutzen.';
            }
            
            showFeedback(1, isCorrect, feedbackMessage);
            saveTaskResult(1, `${gap1}|${gap2}|${gap3}`, isCorrect);
        }

        // Aufgabe 2: Multiple Choice
        let selectedOption = null;

        function selectOption(element, option) {
            // Alle Optionen zur√ºcksetzen
            document.querySelectorAll('#task-2 .option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Gew√§hlte Option markieren
            element.classList.add('selected');
            selectedOption = option;
        }

        function checkTask2() {
            if (!selectedOption) {
                showFeedback(2, false, 'Bitte w√§hlen Sie eine Antwort aus.');
                return;
            }
            
            const isCorrect = selectedOption === 'd';
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '‚úÖ Richtig! Alle genannten Ausgaben k√∂nnen als Werbungskosten geltend gemacht werden.';
            } else {
                feedbackMessage = '‚ùå Falsch.<br><br><strong>Vollst√§ndige L√∂sung:</strong><br>';
                feedbackMessage += '‚úì <strong>Fahrtkosten zur Arbeit</strong> - absetzbar als Werbungskosten<br>';
                feedbackMessage += '‚úì <strong>Fortbildungskosten</strong> - absetzbar als Werbungskosten<br>';
                feedbackMessage += '‚úì <strong>Arbeitskleidung</strong> - absetzbar als Werbungskosten<br>';
                feedbackMessage += '‚úì <strong>Alle genannten</strong> - dies ist die richtige Antwort!';
            }
            
            showFeedback(2, isCorrect, feedbackMessage);
            saveTaskResult(2, selectedOption, isCorrect);
        }

        // Aufgabe 3: Drag & Drop
        function setupDragAndDrop() {
            const container = document.getElementById('sortable-list');
            const items = container.querySelectorAll('.sortable-item');
            
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', item.outerHTML);
                    item.classList.add('dragging');
                    setTimeout(() => {
                        item.style.display = 'none';
                    }, 0);
                });

                item.addEventListener('dragend', (e) => {
                    item.style.display = 'block';
                    item.classList.remove('dragging');
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                item.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                });

                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const draggedHTML = e.dataTransfer.getData('text/html');
                    const draggedElement = document.createElement('div');
                    draggedElement.innerHTML = draggedHTML;
                    const draggedItem = draggedElement.firstChild;
                    
                    // Event Listener f√ºr das neue Element hinzuf√ºgen
                    setupSingleItem(draggedItem);
                    
                    // Element vor dem aktuellen einf√ºgen
                    container.insertBefore(draggedItem, item);
                    
                    // Das urspr√ºnglich gezogene Element entfernen
                    const draggingElement = container.querySelector('.dragging');
                    if (draggingElement) {
                        draggingElement.remove();
                    }
                });
            });

            // Container Drop Event
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            container.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggedHTML = e.dataTransfer.getData('text/html');
                if (draggedHTML && !e.target.classList.contains('sortable-item')) {
                    const draggedElement = document.createElement('div');
                    draggedElement.innerHTML = draggedHTML;
                    const draggedItem = draggedElement.firstChild;
                    
                    // Event Listener f√ºr das neue Element hinzuf√ºgen
                    setupSingleItem(draggedItem);
                    
                    // Element am Ende hinzuf√ºgen
                    container.appendChild(draggedItem);
                    
                    // Das urspr√ºnglich gezogene Element entfernen
                    const draggingElement = container.querySelector('.dragging');
                    if (draggingElement) {
                        draggingElement.remove();
                    }
                }
            });
        }

        function setupSingleItem(item) {
            item.addEventListener('dragstart', (e) => {
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', item.outerHTML);
                item.classList.add('dragging');
                setTimeout(() => {
                    item.style.display = 'none';
                }, 0);
            });

            item.addEventListener('dragend', (e) => {
                item.style.display = 'block';
                item.classList.remove('dragging');
            });

            item.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            item.addEventListener('dragenter', (e) => {
                e.preventDefault();
            });

            item.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggedHTML = e.dataTransfer.getData('text/html');
                const draggedElement = document.createElement('div');
                draggedElement.innerHTML = draggedHTML;
                const draggedItem = draggedElement.firstChild;
                
                // Event Listener f√ºr das neue Element hinzuf√ºgen
                setupSingleItem(draggedItem);
                
                // Element vor dem aktuellen einf√ºgen
                const container = document.getElementById('sortable-list');
                container.insertBefore(draggedItem, item);
                
                // Das urspr√ºnglich gezogene Element entfernen
                const draggingElement = container.querySelector('.dragging');
                if (draggingElement) {
                    draggingElement.remove();
                }
            });
        }

        function checkTask3() {
            const items = document.querySelectorAll('#sortable-list .sortable-item');
            const currentOrder = Array.from(items).map(item => item.getAttribute('data-order'));
            const correctOrder = ['1', '2', '3', '4'];
            
            const isCorrect = JSON.stringify(currentOrder) === JSON.stringify(correctOrder);
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '‚úÖ Richtig! Die Reihenfolge entspricht der Steuerbelastung von niedrig zu hoch.';
            } else {
                feedbackMessage = '‚ùå Falsch.<br><br><strong>Vollst√§ndige L√∂sung (nach Steuerbelastung sortiert):</strong><br>';
                feedbackMessage += '1. <strong>Steuerklasse III</strong> (verheiratet, Alleinverdiener) - niedrigste Belastung<br>';
                feedbackMessage += '2. <strong>Steuerklasse V</strong> (verheiratet, Zweitverdiener)<br>';
                feedbackMessage += '3. <strong>Steuerklasse I</strong> (ledig)<br>';
                feedbackMessage += '4. <strong>Steuerklasse IV</strong> (verheiratet, beide berufst√§tig) - h√∂chste Belastung';
            }
            
            showFeedback(3, isCorrect, feedbackMessage);
            saveTaskResult(3, currentOrder.join(','), isCorrect);
        }

        // Aufgabe 4: Zuordnung
        let selectedMatchingItem = null;
        let matches = {};

        function selectMatching(element) {
            if (element.classList.contains('matched')) return;
            
            // Vorherige Auswahl zur√ºcksetzen
            document.querySelectorAll('.matching-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            element.classList.add('selected');
            selectedMatchingItem = element;
        }

        function selectCategory(element) {
            if (!selectedMatchingItem || selectedMatchingItem.classList.contains('matched')) return;
            
            const itemMatch = selectedMatchingItem.getAttribute('data-match');
            const categoryMatch = element.getAttribute('data-category');
            
            if (itemMatch === categoryMatch) {
                selectedMatchingItem.classList.add('matched');
                selectedMatchingItem.classList.remove('selected');
                matches[selectedMatchingItem.textContent] = element.textContent;
                selectedMatchingItem = null;
            } else {
                // Kurz rot blinken lassen
                element.style.background = 'rgba(255, 59, 48, 0.2)';
                setTimeout(() => {
                    element.style.background = '';
                }, 300);
            }
        }

        function checkTask4() {
            const matchedItems = document.querySelectorAll('#task-4 .matching-item.matched').length;
            const isCorrect = matchedItems === 4;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '‚úÖ Richtig! Alle Steuerarten wurden korrekt zugeordnet.';
            } else {
                feedbackMessage = '‚ùå Noch nicht alle Zuordnungen sind korrekt.<br><br><strong>Vollst√§ndige L√∂sung:</strong><br>';
                feedbackMessage += '<strong>Direkte Steuern:</strong><br>';
                feedbackMessage += '‚Ä¢ <strong>Einkommensteuer</strong> - wird direkt vom Einkommen erhoben<br>';
                feedbackMessage += '‚Ä¢ <strong>K√∂rperschaftsteuer</strong> - wird direkt von Unternehmen erhoben<br><br>';
                feedbackMessage += '<strong>Indirekte Steuern:</strong><br>';
                feedbackMessage += '‚Ä¢ <strong>Mehrwertsteuer</strong> - wird √ºber den Konsum erhoben<br>';
                feedbackMessage += '‚Ä¢ <strong>Mineral√∂lsteuer</strong> - wird √ºber den Kraftstoffverbrauch erhoben';
            }
            
            showFeedback(4, isCorrect, feedbackMessage);
            
            if (isCorrect) {
                saveTaskResult(4, JSON.stringify(matches), true);
            }
        }

        // Aufgabe 5: Slider
        function updateSliderValue(value) {
            document.getElementById('slider-value').textContent = value + '%';
        }

        function checkTask5() {
            const sliderValue = parseInt(document.getElementById('tax-slider').value);
            // F√ºr 45.000‚Ç¨ liegt der Steuersatz bei etwa 25-30%
            const isCorrect = sliderValue >= 25 && sliderValue <= 30;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = `‚úÖ Richtig! Bei 45.000‚Ç¨ zu versteuerndem Einkommen liegt der Steuersatz bei etwa 25-30%. Sie haben ${sliderValue}% gew√§hlt.`;
            } else {
                feedbackMessage = `‚ùå Nicht ganz richtig. Sie haben ${sliderValue}% gew√§hlt.<br><br><strong>Vollst√§ndige L√∂sung:</strong><br>`;
                feedbackMessage += 'Bei einem zu versteuernden Einkommen von <strong>45.000 ‚Ç¨</strong> liegt der Steuersatz bei etwa <strong>25-30%</strong>.<br><br>';
                feedbackMessage += '<strong>Erkl√§rung:</strong><br>';
                feedbackMessage += '‚Ä¢ Eingangssteuersatz: 14% (ab 10.908 ‚Ç¨)<br>';
                feedbackMessage += '‚Ä¢ Progressiver Anstieg bis zum Spitzensteuersatz<br>';
                feedbackMessage += '‚Ä¢ Bei 45.000 ‚Ç¨: ca. 25-30% Durchschnittssteuersatz<br>';
                feedbackMessage += '‚Ä¢ Spitzensteuersatz: 42% (ab 62.810 ‚Ç¨)';
            }
            
            showFeedback(5, isCorrect, feedbackMessage);
            saveTaskResult(5, sliderValue.toString(), isCorrect);
        }

        // Aufgabe 6: Wahr/Falsch
        let trueFalseAnswer = null;

        function selectTrueFalse(element, answer) {
            document.querySelectorAll('#task-6 .option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            element.classList.add('selected');
            trueFalseAnswer = answer;
        }

        function checkTask6() {
            if (trueFalseAnswer === null) {
                showFeedback(6, false, 'Bitte w√§hlen Sie eine Antwort aus.');
                return;
            }
            
            const isCorrect = trueFalseAnswer === false;
            
            let feedbackMessage = '';
            if (isCorrect) {
                feedbackMessage = '‚úÖ Richtig! Die Aussage ist falsch. Die Kirchensteuer wird nicht nur von der Einkommensteuer erhoben.';
            } else {
                feedbackMessage = '‚ùå Falsch. Die Aussage ist nicht richtig.<br><br><strong>Vollst√§ndige L√∂sung:</strong><br>';
                feedbackMessage += 'Die Aussage "<em>Die Kirchensteuer wird nur von der Einkommensteuer erhoben</em>" ist <strong>FALSCH</strong>.<br><br>';
                feedbackMessage += '<strong>Erkl√§rung:</strong><br>';
                feedbackMessage += 'Die Kirchensteuer wird erhoben von:<br>';
                feedbackMessage += '‚Ä¢ <strong>Einkommensteuer</strong><br>';
                feedbackMessage += '‚Ä¢ <strong>Lohnsteuer</strong><br>';
                feedbackMessage += '‚Ä¢ <strong>Kapitalertragsteuer</strong><br>';
                feedbackMessage += '‚Ä¢ <strong>K√∂rperschaftsteuer</strong> (bei juristischen Personen)';
            }
            
            showFeedback(6, isCorrect, feedbackMessage);
            saveTaskResult(6, trueFalseAnswer.toString(), isCorrect);
        }

        // Aufgabe 7: Freitext
        function checkTask7() {
            const answer = document.getElementById('freetext-answer').value.trim();
            
            if (answer.length < 10) {
                showFeedback(7, false, 'Bitte geben Sie eine ausf√ºhrlichere Antwort ein.');
                return;
            }
            
            // Freitext wird immer als korrekt gewertet, da keine automatische Bewertung m√∂glich
            let feedbackMessage = '‚úÖ Vielen Dank f√ºr Ihre Antwort!<br><br><strong>Vollst√§ndige Musterl√∂sung:</strong><br>';
            feedbackMessage += '<strong>Bruttoeinkommen:</strong> Das Gesamteinkommen vor allen Abz√ºgen (Steuern, Sozialversicherung, etc.)<br><br>';
            feedbackMessage += '<strong>Nettoeinkommen:</strong> Das verf√ºgbare Einkommen nach Abzug aller Steuern und Sozialabgaben<br><br>';
            feedbackMessage += '<strong>Beispiel:</strong><br>';
            feedbackMessage += '‚Ä¢ Brutto: 3.000 ‚Ç¨ monatlich<br>';
            feedbackMessage += '‚Ä¢ Abz√ºge: ca. 900 ‚Ç¨ (Steuern + Sozialversicherung)<br>';
            feedbackMessage += '‚Ä¢ Netto: ca. 2.100 ‚Ç¨ (verf√ºgbares Einkommen)';
            
            showFeedback(7, true, feedbackMessage);
            saveTaskResult(7, answer, true);
        }

        // Hilfsfunktionen
        function showFeedback(taskNumber, isCorrect, message) {
            const feedback = document.getElementById(`feedback-${taskNumber}`);
            feedback.innerHTML = message;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.display = 'block';
            
            if (isCorrect && !userAnswers[taskNumber]) {
                completedTasks++;
                correctAnswers++;
                updateProgress();
            }
            
            totalAttempts++;
            taskAttempts[taskNumber] = (taskAttempts[taskNumber] || 0) + 1;
            
            // Button zu "Weiter" √§ndern nach dem Pr√ºfen
            const currentTaskCard = document.getElementById(`task-${taskNumber}`);
            const checkButton = currentTaskCard.querySelector('.btn-primary');
            
            if (taskNumber < totalTasks) {
                checkButton.textContent = 'Weiter';
                checkButton.onclick = () => nextTask();
            } else {
                checkButton.textContent = 'Abschlie√üen';
                checkButton.onclick = () => showCompletionScreen();
            }
            
            setTimeout(() => {
                updateNavigationButtons();
                if (completedTasks === totalTasks && taskNumber === totalTasks) {
                    setTimeout(() => {
                        showCompletionScreen();
                    }, 2000);
                }
            }, 100);
        }

        async function saveTaskResult(taskId, userAnswer, isCorrect) {
            userAnswers[taskId] = { answer: userAnswer, correct: isCorrect };
            
            if (window.dataSdk) {
                const result = await window.dataSdk.create({
                    task_id: `task_${taskId}`,
                    task_type: getTaskType(taskId),
                    user_answer: userAnswer,
                    is_correct: isCorrect,
                    completed_at: new Date().toISOString(),
                    attempts: taskAttempts[taskId] || 1
                });
                
                if (!result.isOk) {
                    console.error("Failed to save task result");
                }
            }
        }

        function getTaskType(taskId) {
            const types = {
                1: 'L√ºckentext',
                2: 'Multiple Choice',
                3: 'Sortierung',
                4: 'Zuordnung',
                5: 'Berechnung',
                6: 'Wahr/Falsch',
                7: 'Freitext'
            };
            return types[taskId] || 'Unbekannt';
        }

        function showCompletionScreen() {
            // Alle Aufgaben ausblenden
            for (let i = 1; i <= totalTasks; i++) {
                document.getElementById(`task-${i}`).classList.remove('active');
            }
            
            // Navigation ausblenden
            document.getElementById('navigation-buttons').style.display = 'none';
            
            // Statistiken aktualisieren
            document.getElementById('correct-answers').textContent = correctAnswers;
            document.getElementById('total-attempts').textContent = totalAttempts;
            document.getElementById('success-rate').textContent = Math.round((correctAnswers / totalTasks) * 100) + '%';
            
            // Abschlussbildschirm anzeigen
            document.getElementById('completion-screen').classList.add('active');
        }

        function updateStatsFromData(data) {
            const uniqueTasks = new Set(data.map(item => item.task_id));
            const correctTasks = data.filter(item => item.is_correct);
            
            if (uniqueTasks.size > 0) {
                document.getElementById('correct-answers').textContent = correctTasks.length;
                document.getElementById('total-attempts').textContent = data.length;
                document.getElementById('success-rate').textContent = Math.round((correctTasks.length / uniqueTasks.size) * 100) + '%';
            }
        }

        function restartQuiz() {
            // Alle Variablen zur√ºcksetzen
            currentTask = 1;
            completedTasks = 0;
            userAnswers = {};
            taskAttempts = {};
            correctAnswers = 0;
            totalAttempts = 0;
            selectedOption = null;
            trueFalseAnswer = null;
            selectedMatchingItem = null;
            matches = {};
            
            // UI zur√ºcksetzen
            updateProgress();
            document.getElementById('completion-screen').classList.remove('active');
            document.getElementById('navigation-buttons').style.display = 'flex';
            
            // Alle Feedbacks ausblenden
            for (let i = 1; i <= totalTasks; i++) {
                document.getElementById(`feedback-${i}`).style.display = 'none';
            }
            
            // Alle Buttons zur√ºcksetzen
            resetTaskButtons();
            
            // Alle Eingaben zur√ºcksetzen
            document.getElementById('gap-1').textContent = '';
            document.getElementById('gap-2').textContent = '';
            document.getElementById('gap-3').textContent = '';
            document.getElementById('freetext-answer').value = '';
            document.getElementById('tax-slider').value = 20;
            updateSliderValue(20);
            
            // Optionen zur√ºcksetzen
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Matching zur√ºcksetzen
            document.querySelectorAll('.matching-item').forEach(item => {
                item.classList.remove('selected', 'matched');
            });
            
            // Erste Aufgabe anzeigen
            showTask(1);
        }

        function resetTaskButtons() {
            // Alle Buttons zu ihrem urspr√ºnglichen Zustand zur√ºcksetzen
            const taskButtons = [
                { id: 'task-1', text: 'Antwort pr√ºfen', onclick: 'checkTask1()' },
                { id: 'task-2', text: 'Antwort pr√ºfen', onclick: 'checkTask2()' },
                { id: 'task-3', text: 'Reihenfolge pr√ºfen', onclick: 'checkTask3()' },
                { id: 'task-4', text: 'Zuordnung pr√ºfen', onclick: 'checkTask4()' },
                { id: 'task-5', text: 'Steuersatz pr√ºfen', onclick: 'checkTask5()' },
                { id: 'task-6', text: 'Antwort pr√ºfen', onclick: 'checkTask6()' },
                { id: 'task-7', text: 'Antwort einreichen', onclick: 'checkTask7()' }
            ];
            
            taskButtons.forEach(task => {
                const taskCard = document.getElementById(task.id);
                const button = taskCard.querySelector('.btn-primary');
                button.textContent = task.text;
                button.setAttribute('onclick', task.onclick);
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99ee7f5aa6ab4e42',t:'MTc2MzIwNzA3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
